{"version":3,"sources":["../src/browser-sprite.ts"],"sourcesContent":["import { BrowserSymbol } from './browser-symbol';\n\nconst namespaceURI = 'http://www.w3.org/2000/svg';\n\nexport interface SpriteConfig {\n  attrs?: Record<string, string>;\n}\n\nexport class BrowserSprite {\n  private symbols: Map<string, BrowserSymbol> = new Map();\n  private config: SpriteConfig = {\n    attrs: {\n      'xmlns': namespaceURI,\n      'xmlns:xlink': 'http://www.w3.org/1999/xlink',\n      'style': 'position:absolute;width:0;height:0',\n      'aria-hidden': 'true',\n    },\n  };\n\n  node: Element | null = null;\n\n  constructor(config: SpriteConfig = {}) {\n    Object.assign(this.config.attrs!, config.attrs);\n  }\n\n  private push(symbol: BrowserSymbol) {\n    const { symbols } = this;\n    const existing = symbols.has(symbol.id);\n\n    symbols.set(symbol.id, symbol);\n\n    return !existing;\n  }\n\n  add(symbol: BrowserSymbol) {\n    const isNewSymbol = this.push(symbol);\n\n    if (!!this.node && isNewSymbol) {\n      symbol.mount(this.node);\n    }\n\n    return isNewSymbol;\n  }\n\n  attach(target: Element) {\n    if (!!this.node) {\n      return;\n    }\n\n    this.node = target;\n\n    // Already added symbols needs to be mounted\n    this.symbols.forEach((symbol) => {\n      symbol.mount(target);\n    });\n\n    // Create symbols from existing DOM nodes, add and mount them\n    target.querySelectorAll('symbol').forEach((symbolNode: Element) => {\n      const symbol = BrowserSymbol.createFromExistingNode(symbolNode);\n      this.add(symbol);\n    });\n  }\n\n  mount(target: Node, prepend = false) {\n    if (!!this.node) {\n      return this.node;\n    }\n\n    this.node = this.render();\n\n    if (prepend && target.childNodes[0]) {\n      target.insertBefore(this.node, target.firstChild);\n    } else {\n      target.appendChild(this.node);\n    }\n\n    return this.node;\n  }\n\n  private render() {\n    const el = document.createElementNS(namespaceURI, 'svg');\n\n    Object.entries(this.config.attrs!).forEach((entry) => el.setAttribute(entry[0], entry[1]));\n    this.symbols.forEach((symbol) => el.appendChild(symbol.node));\n\n    return el;\n  }\n\n  unmount() {\n    this.node && this.node.parentNode && this.node.parentNode.removeChild(this.node);\n  }\n}\n"],"names":["BrowserSymbol","namespaceURI","BrowserSprite","config","symbols","Map","attrs","node","Object","assign","push","symbol","existing","has","id","set","add","isNewSymbol","mount","attach","target","forEach","querySelectorAll","symbolNode","createFromExistingNode","prepend","render","childNodes","insertBefore","firstChild","appendChild","el","document","createElementNS","entries","entry","setAttribute","unmount","parentNode","removeChild"],"mappings":";;;AAAA,SAASA,aAAa,QAAQ,mBAAmB;AAEjD,IAAMC,eAAe;AAMrB,OAAO,IAAA,AAAMC,8BAAN;;aAAMA;YAaCC,SAAAA,iEAAuB,CAAC;gCAbzBD;QACX,uBAAQE,WAAsC,IAAIC;QAClD,uBAAQF,UAAuB;YAC7BG,OAAO;gBACL,SAASL;gBACT,eAAe;gBACf,SAAS;gBACT,eAAe;YACjB;QACF;QAEAM,uBAAAA,QAAuB;QAGrBC,OAAOC,MAAM,CAAC,IAAI,CAACN,MAAM,CAACG,KAAK,EAAGH,OAAOG,KAAK;;kBAdrCJ;;YAiBHQ,KAAAA;mBAAR,SAAQA,KAAKC,MAAqB;gBAChC,IAAM,AAAEP,UAAY,IAAI,CAAhBA;gBACR,IAAMQ,WAAWR,QAAQS,GAAG,CAACF,OAAOG,EAAE;gBAEtCV,QAAQW,GAAG,CAACJ,OAAOG,EAAE,EAAEH;gBAEvB,OAAO,CAACC;YACV;;;YAEAI,KAAAA;mBAAAA,SAAAA,IAAIL,MAAqB;gBACvB,IAAMM,cAAc,IAAI,CAACP,IAAI,CAACC;gBAE9B,IAAI,CAAC,CAAC,IAAI,CAACJ,IAAI,IAAIU,aAAa;oBAC9BN,OAAOO,KAAK,CAAC,IAAI,CAACX,IAAI;gBACxB;gBAEA,OAAOU;YACT;;;YAEAE,KAAAA;mBAAAA,SAAAA,OAAOC,MAAe;;gBACpB,IAAI,CAAC,CAAC,IAAI,CAACb,IAAI,EAAE;oBACf;gBACF;gBAEA,IAAI,CAACA,IAAI,GAAGa;gBAEZ,4CAA4C;gBAC5C,IAAI,CAAChB,OAAO,CAACiB,OAAO,CAAC,SAACV;oBACpBA,OAAOO,KAAK,CAACE;gBACf;gBAEA,6DAA6D;gBAC7DA,OAAOE,gBAAgB,CAAC,UAAUD,OAAO,CAAC,SAACE;oBACzC,IAAMZ,SAASX,cAAcwB,sBAAsB,CAACD;oBACpD,MAAKP,GAAG,CAACL;gBACX;YACF;;;YAEAO,KAAAA;mBAAAA,SAAAA,MAAME,MAAY;oBAAEK,UAAAA,iEAAU;gBAC5B,IAAI,CAAC,CAAC,IAAI,CAAClB,IAAI,EAAE;oBACf,OAAO,IAAI,CAACA,IAAI;gBAClB;gBAEA,IAAI,CAACA,IAAI,GAAG,IAAI,CAACmB,MAAM;gBAEvB,IAAID,WAAWL,OAAOO,UAAU,CAAC,EAAE,EAAE;oBACnCP,OAAOQ,YAAY,CAAC,IAAI,CAACrB,IAAI,EAAEa,OAAOS,UAAU;gBAClD,OAAO;oBACLT,OAAOU,WAAW,CAAC,IAAI,CAACvB,IAAI;gBAC9B;gBAEA,OAAO,IAAI,CAACA,IAAI;YAClB;;;YAEQmB,KAAAA;mBAAR,SAAQA;gBACN,IAAMK,KAAKC,SAASC,eAAe,CAAChC,cAAc;gBAElDO,OAAO0B,OAAO,CAAC,IAAI,CAAC/B,MAAM,CAACG,KAAK,EAAGe,OAAO,CAAC,SAACc;2BAAUJ,GAAGK,YAAY,CAACD,KAAK,CAAC,EAAE,EAAEA,KAAK,CAAC,EAAE;;gBACxF,IAAI,CAAC/B,OAAO,CAACiB,OAAO,CAAC,SAACV;2BAAWoB,GAAGD,WAAW,CAACnB,OAAOJ,IAAI;;gBAE3D,OAAOwB;YACT;;;YAEAM,KAAAA;mBAAAA,SAAAA;gBACE,IAAI,CAAC9B,IAAI,IAAI,IAAI,CAACA,IAAI,CAAC+B,UAAU,IAAI,IAAI,CAAC/B,IAAI,CAAC+B,UAAU,CAACC,WAAW,CAAC,IAAI,CAAChC,IAAI;YACjF;;;WAlFWL;IAmFZ"}