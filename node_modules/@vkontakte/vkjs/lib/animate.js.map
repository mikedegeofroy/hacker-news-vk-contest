{"version":3,"sources":["../src/animate.ts"],"sourcesContent":["import { canUseDOM, canUseEventListeners } from './dom';\nimport { SupportEvent } from './types';\n\ntype TimingInterface = (timeFraction: number) => number;\n\ntype DrawInterface = (progress: number) => void;\n\ninterface AnimateArgumentsInterface {\n  duration: number;\n  timing: TimingInterface;\n  draw: DrawInterface;\n}\n\n/**\n * Функция для js анимации\n * @param {number} duration\n * @param {function} timing тайминг функция анимации\n * @param {function} draw коллбэк, в который прокидывается прогресс [0, 1]\n * @returns {void}\n */\nexport function animate({ duration, timing, draw }: AnimateArgumentsInterface) {\n  if (!canUseDOM) {\n    return;\n  }\n\n  const start = window.performance.now();\n\n  // eslint-disable-next-line no-shadow\n  window.requestAnimationFrame(function animate(time) {\n    let timeFraction = (time - start) / duration;\n\n    if (timeFraction > 1) {\n      timeFraction = 1;\n    }\n\n    const progress = timing(timeFraction);\n\n    draw(progress);\n\n    if (timeFraction < 1) {\n      window.requestAnimationFrame(animate);\n    }\n  });\n}\n\n// WebKitAnimationEvent и WebKitTransitionEvent не существуют в глобальном контексте\ndeclare const WebKitAnimationEvent: AnimationEvent;\ndeclare const WebKitTransitionEvent: TransitionEvent;\n\nexport const animationEvent = /*#__PURE__*/ (() => {\n  const obj: SupportEvent<'animationend'> = {\n    supported: false,\n    name: 'animationend',\n  };\n\n  if (canUseDOM) {\n    if (typeof AnimationEvent !== 'undefined') {\n      obj.supported = true;\n    } else if (typeof WebKitAnimationEvent !== 'undefined') {\n      obj.supported = true;\n\n      // webkitAnimationEnd не входит в перечисление событий, но соответствует animationend\n      obj.name = 'webkitAnimationEnd' as unknown as 'animationend';\n    }\n  }\n\n  return obj;\n})();\n\nexport const transitionEvent = /*#__PURE__*/ (() => {\n  const obj: SupportEvent<'transitionend'> = {\n    supported: false,\n    name: 'transitionend',\n  };\n\n  if (canUseDOM) {\n    if (typeof TransitionEvent !== 'undefined') {\n      obj.supported = true;\n    } else if (typeof WebKitTransitionEvent !== 'undefined') {\n      obj.supported = true;\n\n      // webkitTransitionEnd не входит в перечисление событий, но соответствует transitionend\n      obj.name = 'webkitTransitionEnd' as unknown as 'transitionend';\n    }\n  }\n\n  return obj;\n})();\n\n/**\n * Ожидание окончания анимации на элементе\n *\n * @param listener коллбэк окончания ожидания\n * @param fallbackTime сколько ждать в мс если событие не поддерживается\n * @param el элемент\n */\nexport function waitAnimationEnd(\n  listener: (ev?: AnimationEvent) => any,\n  fallbackTime: number,\n  el?: GlobalEventHandlers,\n) {\n  if (canUseEventListeners) {\n    if (animationEvent.supported && el) {\n      el.addEventListener(animationEvent.name, listener);\n    } else {\n      return window.setTimeout(listener, fallbackTime);\n    }\n  }\n}\n\n/**\n * Прекращение ожидания окончания анимации на элементе\n *\n * @param listener коллбэк окончания ожидания\n * @param handle то, что вернулось из ```waitAnimationEnd```\n * @param el элемент\n */\nexport function cancelWaitAnimationEnd(\n  listener: (ev?: AnimationEvent) => any,\n  handle?: number,\n  el?: GlobalEventHandlers,\n) {\n  if (canUseEventListeners) {\n    if (animationEvent.supported && el) {\n      el.removeEventListener(animationEvent.name, listener);\n    } else {\n      window.clearTimeout(handle);\n    }\n  }\n}\n\n/**\n * Ожидание окончания анимации перехода на элементе\n *\n * @param listener коллбэк окончания ожидания\n * @param fallbackTime сколько ждать в мс если событие не поддерживается\n * @param el элемент\n */\nexport function waitTransitionEnd(\n  el: GlobalEventHandlers,\n  listener: (ev?: TransitionEvent) => any,\n  fallbackTime: number,\n) {\n  if (canUseEventListeners) {\n    if (transitionEvent.supported && el) {\n      el.addEventListener(transitionEvent.name, listener);\n    } else {\n      return window.setTimeout(listener, fallbackTime);\n    }\n  }\n}\n\n/**\n * Прекращение ожидания окончания анимации перехода на элементе\n *\n * @param listener коллбэк окончания ожидания\n * @param handle то, что вернулось из ```waitTransitionEnd```\n * @param el элемент\n */\nexport function cancelWaitTransitionEnd(\n  listener: (ev?: TransitionEvent) => any,\n  handle?: number,\n  el?: GlobalEventHandlers,\n) {\n  if (canUseEventListeners) {\n    if (transitionEvent.supported && el) {\n      el.removeEventListener(transitionEvent.name, listener);\n    } else {\n      window.clearTimeout(handle);\n    }\n  }\n}\n"],"names":["animate","animationEvent","cancelWaitAnimationEnd","cancelWaitTransitionEnd","transitionEvent","waitAnimationEnd","waitTransitionEnd","duration","timing","draw","canUseDOM","start","window","performance","now","requestAnimationFrame","time","timeFraction","progress","obj","supported","name","AnimationEvent","WebKitAnimationEvent","TransitionEvent","WebKitTransitionEvent","listener","fallbackTime","el","canUseEventListeners","addEventListener","setTimeout","handle","removeEventListener","clearTimeout"],"mappings":";;;;;;;;;;;IAoBgBA,OAAO;eAAPA;;IA6BHC,cAAc;eAAdA;;IAoEGC,sBAAsB;eAAtBA;;IA0CAC,uBAAuB;eAAvBA;;IA1FHC,eAAe;eAAfA;;IA2BGC,gBAAgB;eAAhBA;;IA0CAC,iBAAiB;eAAjBA;;;mBA1IgC;AAahD;;;;;;CAMC,GACM,SAASN,QAAQ,KAAqD;QAAnDO,WAAF,MAAEA,UAAUC,SAAZ,MAAYA,QAAQC,OAApB,MAAoBA;IAC1C,IAAI,CAACC,cAAS,EAAE;QACd;IACF;IAEA,IAAMC,QAAQC,OAAOC,WAAW,CAACC,GAAG;IAEpC,qCAAqC;IACrCF,OAAOG,qBAAqB,CAAC,SAASf,QAAQgB,IAAI;QAChD,IAAIC,eAAe,AAACD,CAAAA,OAAOL,KAAI,IAAKJ;QAEpC,IAAIU,eAAe,GAAG;YACpBA,eAAe;QACjB;QAEA,IAAMC,WAAWV,OAAOS;QAExBR,KAAKS;QAEL,IAAID,eAAe,GAAG;YACpBL,OAAOG,qBAAqB,CAACf;QAC/B;IACF;AACF;AAEA,oFAAoF;AAI7E,IAAMC,iBAA+B,AAAd,WAAW,GAAI;IAC3C,IAAMkB,MAAoC;QACxCC,WAAW;QACXC,MAAM;IACR;IAEA,IAAIX,cAAS,EAAE;QACb,IAAI,OAAOY,mBAAmB,aAAa;YACzCH,IAAIC,SAAS,GAAG;QAClB,OAAO,IAAI,OAAOG,yBAAyB,aAAa;YACtDJ,IAAIC,SAAS,GAAG;YAEhB,qFAAqF;YACrFD,IAAIE,IAAI,GAAG;QACb;IACF;IAEA,OAAOF;AACT;AAEO,IAAMf,kBAAgC,AAAd,WAAW,GAAI;IAC5C,IAAMe,MAAqC;QACzCC,WAAW;QACXC,MAAM;IACR;IAEA,IAAIX,cAAS,EAAE;QACb,IAAI,OAAOc,oBAAoB,aAAa;YAC1CL,IAAIC,SAAS,GAAG;QAClB,OAAO,IAAI,OAAOK,0BAA0B,aAAa;YACvDN,IAAIC,SAAS,GAAG;YAEhB,uFAAuF;YACvFD,IAAIE,IAAI,GAAG;QACb;IACF;IAEA,OAAOF;AACT;AAEA;;;;;;CAMC,GACM,SAASd,iBACdqB,QAAsC,EACtCC,YAAoB,EACpBC,EAAwB;IAExB,IAAIC,yBAAoB,EAAE;QACxB,IAAI5B,eAAemB,SAAS,IAAIQ,IAAI;YAClCA,GAAGE,gBAAgB,CAAC7B,eAAeoB,IAAI,EAAEK;QAC3C,OAAO;YACL,OAAOd,OAAOmB,UAAU,CAACL,UAAUC;QACrC;IACF;AACF;AAEA;;;;;;CAMC,GACM,SAASzB,uBACdwB,QAAsC,EACtCM,MAAe,EACfJ,EAAwB;IAExB,IAAIC,yBAAoB,EAAE;QACxB,IAAI5B,eAAemB,SAAS,IAAIQ,IAAI;YAClCA,GAAGK,mBAAmB,CAAChC,eAAeoB,IAAI,EAAEK;QAC9C,OAAO;YACLd,OAAOsB,YAAY,CAACF;QACtB;IACF;AACF;AAEA;;;;;;CAMC,GACM,SAAS1B,kBACdsB,EAAuB,EACvBF,QAAuC,EACvCC,YAAoB;IAEpB,IAAIE,yBAAoB,EAAE;QACxB,IAAIzB,gBAAgBgB,SAAS,IAAIQ,IAAI;YACnCA,GAAGE,gBAAgB,CAAC1B,gBAAgBiB,IAAI,EAAEK;QAC5C,OAAO;YACL,OAAOd,OAAOmB,UAAU,CAACL,UAAUC;QACrC;IACF;AACF;AAEA;;;;;;CAMC,GACM,SAASxB,wBACduB,QAAuC,EACvCM,MAAe,EACfJ,EAAwB;IAExB,IAAIC,yBAAoB,EAAE;QACxB,IAAIzB,gBAAgBgB,SAAS,IAAIQ,IAAI;YACnCA,GAAGK,mBAAmB,CAAC7B,gBAAgBiB,IAAI,EAAEK;QAC/C,OAAO;YACLd,OAAOsB,YAAY,CAACF;QACtB;IACF;AACF"}