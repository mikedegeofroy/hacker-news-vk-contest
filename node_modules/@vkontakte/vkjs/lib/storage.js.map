{"version":3,"sources":["../src/storage.ts"],"sourcesContent":["import { Dictionary } from './types';\n\nclass CustomStorage {\n  private data: Dictionary<string> = {};\n\n  public setItem(key: string, val: string) {\n    this.data[key] = String(val);\n  }\n\n  public getItem = (key: string) => (this.data.hasOwnProperty(key) ? this.data[key] : null);\n\n  public removeItem(id: string) {\n    delete this.data[id];\n  }\n\n  public clear() {\n    this.data = {};\n  }\n\n  public get length() {\n    return Object.keys(this.data).length;\n  }\n\n  public key(index: number): string | null {\n    return Object.keys(this.data)[index];\n  }\n\n  public keys = (): string[] => Object.keys(this.data);\n}\n\nconst dummyKey = 'vk-ls-dummy';\nconst dummyContent = 'test';\n\nlet ls: CustomStorage | Storage;\n\nfunction getLocalStorage() {\n  if (ls) {\n    return ls;\n  }\n  try {\n    // Проверяем, нет ли в FF или Safari cross domain security restrictions\n    window.localStorage.setItem(dummyKey, dummyContent);\n    if (dummyContent !== window.localStorage.getItem(dummyKey)) {\n      throw new Error('localStorage is broken');\n    }\n    window.localStorage.removeItem(dummyKey);\n    ls = window.localStorage;\n  } catch (e) {\n    ls = new CustomStorage();\n  }\n  return ls;\n}\n\n/**\n * Обертка над localStorage для кода, который может использоваться на других сайтах\n * Firefox блокирует доступ к localStorage для скриптов с других доменов\n */\nexport const localStorage = {\n  setItem: (key: string, val: string) => getLocalStorage().setItem(key, val),\n  getItem: (key: string) => getLocalStorage().getItem(key),\n  removeItem: (key: string) => getLocalStorage().removeItem(key),\n  clear: () => getLocalStorage().clear(),\n  length: () => getLocalStorage().length,\n  key: (index: number) => getLocalStorage().key(index),\n  keys(): string[] {\n    const storage = getLocalStorage();\n    if (storage instanceof CustomStorage) {\n      return storage.keys();\n    } else {\n      return Object.keys(storage);\n    }\n  },\n  getPrefixedKeys: (prefix: string): string[] => {\n    return localStorage.keys().filter((key) => key.startsWith(prefix));\n  },\n};\n\nlet sessionStorageCache: CustomStorage | Storage;\n\nfunction getSessionStorage() {\n  if (sessionStorageCache) {\n    return sessionStorageCache;\n  }\n  try {\n    // Проверяем, нет ли в FF или Safari cross domain security restrictions\n    window.sessionStorage.setItem(dummyKey, dummyContent);\n    if (dummyContent !== window.sessionStorage.getItem(dummyKey)) {\n      throw new Error('sessionStorage is broken');\n    }\n    window.sessionStorage.removeItem(dummyKey);\n    sessionStorageCache = window.sessionStorage;\n  } catch (e) {\n    sessionStorageCache = new CustomStorage();\n  }\n  return sessionStorageCache;\n}\n\nexport const sessionStorage = {\n  setItem: (key: string, val: string) => getSessionStorage().setItem(key, val),\n  getItem: (key: string) => getSessionStorage().getItem(key),\n  removeItem: (key: string) => getSessionStorage().removeItem(key),\n  clear: () => getSessionStorage().clear(),\n  length: () => getSessionStorage().length,\n  key: (index: number) => getSessionStorage().key(index),\n  keys(): string[] {\n    const storage = getSessionStorage();\n    if (storage instanceof CustomStorage) {\n      return storage.keys();\n    } else {\n      return Object.keys(storage);\n    }\n  },\n  getPrefixedKeys: (prefix: string): string[] => {\n    return sessionStorage.keys().filter((key) => key.startsWith(prefix));\n  },\n};\n"],"names":["localStorage","sessionStorage","CustomStorage","data","getItem","key","hasOwnProperty","keys","Object","setItem","val","String","removeItem","id","clear","length","index","dummyKey","dummyContent","ls","getLocalStorage","window","Error","e","storage","getPrefixedKeys","prefix","filter","startsWith","sessionStorageCache","getSessionStorage"],"mappings":"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"}