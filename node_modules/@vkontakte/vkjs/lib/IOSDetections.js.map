{"version":3,"sources":["../src/IOSDetections.ts"],"sourcesContent":["import { canUseDOM } from './dom';\n\nexport const IPHONE_SAFARI_BOTTOM_BAR = 45;\nexport const IPHONE_X_SAFARI_BOTTOM_BAR = 85;\n\nexport const IPHONE_KEYBOARD_REJECT_OFFSET = 180;\n\n// 44 iPhone, 55 iPad, iPad Pro 69\nexport const IOS_NO_KEYBOARD_ALLOWED_OFFSET = 70;\n\nexport function detectIOS(ua?: string) {\n  if (!ua) {\n    ua = canUseDOM ? navigator.userAgent : '';\n  }\n  ua = ua.toLowerCase();\n\n  const isIPadOS = checkIPadOS(ua);\n  const isIPad = isIPadOS || ua.includes('ipad');\n  const isIPhone = !isIPad && ua.search(/iphone|ipod/) !== -1;\n  const isIOS = isIPhone || isIPad;\n\n  let iosVersion: string[] | typeof isIOS | ReturnType<typeof String.prototype.match> =\n    isIOS && ua.match(/os ([\\d_]+) like mac os x/i);\n  let iosMajor = 0;\n  let iosMinor = 0;\n\n  if (isIPadOS) {\n    iosMajor = 13;\n    iosMinor = 0;\n  } else if (iosVersion) {\n    iosVersion = iosVersion[1].split('_');\n    iosMajor = +iosVersion[0];\n    iosMinor = +iosVersion[1];\n  }\n\n  iosVersion = null;\n\n  const isScrollBasedViewport = iosMajor < 13 && !(iosMajor === 11 && iosMinor < 3);\n  const isWKWebView = isIOS && checkWKWebView(ua);\n\n  let isIPhoneX = false;\n\n  if (canUseDOM) {\n    isIPhoneX =\n      isIOS && screen.width === 375 && screen.height === 812 && window.devicePixelRatio === 3;\n  }\n\n  const isIOSChrome = ua.search(/crios/i) !== -1;\n\n  return {\n    isIPad,\n    isIPhone,\n    isIOS,\n    isIPadOS,\n    iosMajor,\n    iosMinor,\n    isWKWebView,\n    isScrollBasedViewport,\n    isIPhoneX,\n    isIOSChrome,\n  };\n}\n\nconst detect = /*#__PURE__*/ detectIOS();\n\nexport const isIPad = /*#__PURE__*/ (() => detect.isIPad)();\nexport const isIPhone = /*#__PURE__*/ (() => detect.isIPhone)();\nexport const isIOS = /*#__PURE__*/ (() => detect.isIOS)();\nexport const isIPadOS = /*#__PURE__*/ (() => detect.isIPadOS)();\nexport const iosMajor = /*#__PURE__*/ (() => detect.iosMajor)();\nexport const iosMinor = /*#__PURE__*/ (() => detect.iosMinor)();\nexport const isWKWebView = /*#__PURE__*/ (() => detect.isWKWebView)();\nexport const isScrollBasedViewport = /*#__PURE__*/ (() => detect.isScrollBasedViewport)();\nexport const isIPhoneX = /*#__PURE__*/ (() => detect.isIPhoneX)();\nexport const isIOSChrome = /*#__PURE__*/ (() => detect.isIOSChrome)();\n\nexport function isLandscapePhone() {\n  return Math.abs(window.orientation) === 90 && !isIPad;\n}\n\n// Reference:\n// https://stackoverflow.com/questions/28795476/detect-if-page-is-loaded-inside-wkwebview-in-javascript/30495399#30495399\nfunction checkWKWebView(ua: string) {\n  if (!canUseDOM) {\n    return false;\n  }\n\n  const webkit = (window as any).webkit;\n\n  if (webkit && webkit.messageHandlers) {\n    return true;\n  }\n\n  const lte9 = /constructor/i.test(String(window.HTMLElement));\n  const idb = !!window.indexedDB;\n\n  if (ua.includes('safari') && ua.includes('version') && !(navigator as any).standalone) {\n    // Safari (WKWebView/Nitro since 6+)\n  } else if ((!idb && lte9) || !(window.statusbar && window.statusbar.visible)) {\n    // UIWebView\n  } else if (!lte9 || idb) {\n    // WKWebView\n    return true;\n  }\n\n  return false;\n}\n\n/**\n * В Safari на iPadOS поле User Agent содержит почти такую же информацию, что и в Safari на MacOS.\n * Из-за чего мы не можем ориентироваться на User Agent.\n *\n * Вместо этого мы пробуем определять есть ли событие 'ontouchend' в объекте document.\n *\n * см. https://developer.apple.com/forums/thread/119186?answerId=705140022#705140022\n */\nexport function checkIPadOS(ua: string) {\n  if (!canUseDOM) {\n    return false;\n  }\n\n  const isNotIOS = !/ipPad|iPhone|iPod/i.test(ua);\n  const isMacOS = /Mac OS/i.test(ua);\n\n  return isNotIOS && isMacOS && 'ontouchend' in document;\n}\n"],"names":["IOS_NO_KEYBOARD_ALLOWED_OFFSET","IPHONE_KEYBOARD_REJECT_OFFSET","IPHONE_SAFARI_BOTTOM_BAR","IPHONE_X_SAFARI_BOTTOM_BAR","checkIPadOS","detectIOS","iosMajor","iosMinor","isIOS","isIOSChrome","isIPad","isIPadOS","isIPhone","isIPhoneX","isLandscapePhone","isScrollBasedViewport","isWKWebView","ua","canUseDOM","navigator","userAgent","toLowerCase","includes","search","iosVersion","match","split","checkWKWebView","screen","width","height","window","devicePixelRatio","detect","Math","abs","orientation","webkit","messageHandlers","lte9","test","String","HTMLElement","idb","indexedDB","standalone","statusbar","visible","isNotIOS","isMacOS","document"],"mappings":"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"}