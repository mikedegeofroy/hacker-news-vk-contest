{"version":3,"sources":["../../src/IOSDetections.ts"],"sourcesContent":["import { canUseDOM } from './dom';\n\nexport const IPHONE_SAFARI_BOTTOM_BAR = 45;\nexport const IPHONE_X_SAFARI_BOTTOM_BAR = 85;\n\nexport const IPHONE_KEYBOARD_REJECT_OFFSET = 180;\n\n// 44 iPhone, 55 iPad, iPad Pro 69\nexport const IOS_NO_KEYBOARD_ALLOWED_OFFSET = 70;\n\nexport function detectIOS(ua?: string) {\n  if (!ua) {\n    ua = canUseDOM ? navigator.userAgent : '';\n  }\n  ua = ua.toLowerCase();\n\n  const isIPadOS = checkIPadOS(ua);\n  const isIPad = isIPadOS || ua.includes('ipad');\n  const isIPhone = !isIPad && ua.search(/iphone|ipod/) !== -1;\n  const isIOS = isIPhone || isIPad;\n\n  let iosVersion: string[] | typeof isIOS | ReturnType<typeof String.prototype.match> =\n    isIOS && ua.match(/os ([\\d_]+) like mac os x/i);\n  let iosMajor = 0;\n  let iosMinor = 0;\n\n  if (isIPadOS) {\n    iosMajor = 13;\n    iosMinor = 0;\n  } else if (iosVersion) {\n    iosVersion = iosVersion[1].split('_');\n    iosMajor = +iosVersion[0];\n    iosMinor = +iosVersion[1];\n  }\n\n  iosVersion = null;\n\n  const isScrollBasedViewport = iosMajor < 13 && !(iosMajor === 11 && iosMinor < 3);\n  const isWKWebView = isIOS && checkWKWebView(ua);\n\n  let isIPhoneX = false;\n\n  if (canUseDOM) {\n    isIPhoneX =\n      isIOS && screen.width === 375 && screen.height === 812 && window.devicePixelRatio === 3;\n  }\n\n  const isIOSChrome = ua.search(/crios/i) !== -1;\n\n  return {\n    isIPad,\n    isIPhone,\n    isIOS,\n    isIPadOS,\n    iosMajor,\n    iosMinor,\n    isWKWebView,\n    isScrollBasedViewport,\n    isIPhoneX,\n    isIOSChrome,\n  };\n}\n\nconst detect = /*#__PURE__*/ detectIOS();\n\nexport const isIPad = /*#__PURE__*/ (() => detect.isIPad)();\nexport const isIPhone = /*#__PURE__*/ (() => detect.isIPhone)();\nexport const isIOS = /*#__PURE__*/ (() => detect.isIOS)();\nexport const isIPadOS = /*#__PURE__*/ (() => detect.isIPadOS)();\nexport const iosMajor = /*#__PURE__*/ (() => detect.iosMajor)();\nexport const iosMinor = /*#__PURE__*/ (() => detect.iosMinor)();\nexport const isWKWebView = /*#__PURE__*/ (() => detect.isWKWebView)();\nexport const isScrollBasedViewport = /*#__PURE__*/ (() => detect.isScrollBasedViewport)();\nexport const isIPhoneX = /*#__PURE__*/ (() => detect.isIPhoneX)();\nexport const isIOSChrome = /*#__PURE__*/ (() => detect.isIOSChrome)();\n\nexport function isLandscapePhone() {\n  return Math.abs(window.orientation) === 90 && !isIPad;\n}\n\n// Reference:\n// https://stackoverflow.com/questions/28795476/detect-if-page-is-loaded-inside-wkwebview-in-javascript/30495399#30495399\nfunction checkWKWebView(ua: string) {\n  if (!canUseDOM) {\n    return false;\n  }\n\n  const webkit = (window as any).webkit;\n\n  if (webkit && webkit.messageHandlers) {\n    return true;\n  }\n\n  const lte9 = /constructor/i.test(String(window.HTMLElement));\n  const idb = !!window.indexedDB;\n\n  if (ua.includes('safari') && ua.includes('version') && !(navigator as any).standalone) {\n    // Safari (WKWebView/Nitro since 6+)\n  } else if ((!idb && lte9) || !(window.statusbar && window.statusbar.visible)) {\n    // UIWebView\n  } else if (!lte9 || idb) {\n    // WKWebView\n    return true;\n  }\n\n  return false;\n}\n\n/**\n * В Safari на iPadOS поле User Agent содержит почти такую же информацию, что и в Safari на MacOS.\n * Из-за чего мы не можем ориентироваться на User Agent.\n *\n * Вместо этого мы пробуем определять есть ли событие 'ontouchend' в объекте document.\n *\n * см. https://developer.apple.com/forums/thread/119186?answerId=705140022#705140022\n */\nexport function checkIPadOS(ua: string) {\n  if (!canUseDOM) {\n    return false;\n  }\n\n  const isNotIOS = !/ipPad|iPhone|iPod/i.test(ua);\n  const isMacOS = /Mac OS/i.test(ua);\n\n  return isNotIOS && isMacOS && 'ontouchend' in document;\n}\n"],"names":["canUseDOM","IPHONE_SAFARI_BOTTOM_BAR","IPHONE_X_SAFARI_BOTTOM_BAR","IPHONE_KEYBOARD_REJECT_OFFSET","IOS_NO_KEYBOARD_ALLOWED_OFFSET","detectIOS","ua","navigator","userAgent","toLowerCase","isIPadOS","checkIPadOS","isIPad","includes","isIPhone","search","isIOS","iosVersion","match","iosMajor","iosMinor","split","isScrollBasedViewport","isWKWebView","checkWKWebView","isIPhoneX","screen","width","height","window","devicePixelRatio","isIOSChrome","detect","isLandscapePhone","Math","abs","orientation","webkit","messageHandlers","lte9","test","String","HTMLElement","idb","indexedDB","standalone","statusbar","visible","isNotIOS","isMacOS","document"],"mappings":"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"}