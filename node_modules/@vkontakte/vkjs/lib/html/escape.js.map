{"version":3,"sources":["../../src/html/escape.ts"],"sourcesContent":["/* eslint-disable @typescript-eslint/quotes */\nimport { Replacer } from '../lib/replacer';\nimport { fromCodePoint, getCodePointAt, numericUnicodeMap } from '../lib/codepoints';\nimport { Dictionary } from '../types';\nimport { buildFullNamedEntities, fullNamedEntities } from './entity';\n\nconst escapeReplacer = /*#__PURE__*/ new Replacer({\n  '&': '&amp;',\n  '<': '&lt;',\n  '>': '&gt;',\n  \"'\": '&#39;',\n  '\"': '&quot;',\n});\n\nconst unescapeReplacer = /*#__PURE__*/ new Replacer({\n  '&amp;': '&',\n  '&#38;': '&',\n  '&lt;': '<',\n  '&#60;': '<',\n  '&gt;': '>',\n  '&#62;': '>',\n  '&apos;': \"'\",\n  '&#39;': \"'\",\n  '&quot;': '\"',\n  '&#34;': '\"',\n});\n\nconst namedEntities: Record<string, string> = {\n  'amp;': '&',\n  'lt;': '<',\n  'gt;': '>',\n  'quot;': '\"',\n  'apos;': `'`,\n};\n\n/**\n * Safely escape HTML entities such as `&`, `<`, `>`, `\"`, and `'`\n * @param {string} input\n */\nexport function escape(input: string): string {\n  return escapeReplacer.replace(input);\n}\n\n/**\n * Unescape HTML entities such as `&`, `<`, `>`, `\"`, and `'`\n * @param {string} input\n */\nexport function unescape(input: string): string {\n  return unescapeReplacer.replace(input);\n}\n\nexport const outOfBoundsChar = /*#__PURE__*/ String.fromCharCode(65533);\n\nconst ENCODE_REGEX =\n  /(?:[<>'\"&\\x01-\\x08\\x11-\\x15\\x17-\\x1F\\x7f-\\uD7FF\\uE000-\\uFFFF]|[\\uD800-\\uDBFF][\\uDC00-\\uDFFF]|[\\uD800-\\uDBFF](?![\\uDC00-\\uDFFF])|(?:[^\\uD800-\\uDBFF]|^)[\\uDC00-\\uDFFF])/g;\n\nexport function encodeHTMLEntities(input: string): string {\n  if (input == null) {\n    return '';\n  }\n\n  return input.replace(ENCODE_REGEX, (entity) => {\n    const code = entity.length > 1 ? getCodePointAt(entity, 0) : entity.charCodeAt(0);\n    return '&#' + String(code) + ';';\n  });\n}\n\nconst DECODE_REGEX = /&(?:#\\d+|#[xX][\\da-fA-F]+|[0-9a-zA-Z]+);?/g;\n\nfunction decodeString(input: string, entities: Record<string, string>): string {\n  if (typeof input !== 'string' || !input) {\n    return '';\n  }\n\n  return input.replace(DECODE_REGEX, (entity) => {\n    if (entity[1] === '#') {\n      // We need to have at least \"&#.\".\n      if (entity.length <= 3) {\n        return entity;\n      }\n\n      const secondChar = entity.charAt(2);\n      const code =\n        secondChar === 'x' || secondChar === 'X'\n          ? parseInt(entity.substr(3).toLowerCase(), 16)\n          : parseInt(entity.substr(2));\n\n      if (code >= 0x10ffff) {\n        return outOfBoundsChar;\n      }\n\n      if (code > 65535) {\n        return fromCodePoint(code);\n      }\n\n      return String.fromCharCode(numericUnicodeMap[code] || code);\n    }\n\n    return entities[entity.slice(1)] || entity;\n  });\n}\n\nexport function decodeHTMLEntitiesDeep<T>(input: T): T {\n  if (typeof input === 'string') {\n    return decodeHTMLEntities(input) as unknown as T;\n  }\n\n  if (typeof input === 'object') {\n    const correctType = Object.prototype.toString.apply(input);\n\n    if (correctType === '[object Array]') {\n      return (input as unknown[]).map((item) => {\n        return decodeHTMLEntitiesDeep(item);\n      }) as T;\n    }\n\n    if (correctType === '[object Object]') {\n      const response: Dictionary<unknown> = {};\n      Object.keys(input as Dictionary<unknown>).forEach((item) => {\n        response[decodeHTMLEntities(item)] = decodeHTMLEntitiesDeep(\n          (input as Dictionary<unknown>)[item],\n        );\n      });\n\n      return response as unknown as T;\n    }\n  }\n\n  return input;\n}\n\n/**\n * `decodeHTMLEntities` декодирует зарезервированные HTML-сущности.\n *\n * Если нужна возможность декодировать все сущности, используйте\n * {@link decodeHTMLFullEntities}\n *\n * @param input текст который необходимо декодировать\n * @param entities кастомный словарь сущностей `{'lt;': '<'}`\n */\nexport function decodeHTMLEntities(input: string, entities = namedEntities): string {\n  return decodeString(input, entities);\n}\n\n/**\n * `decodeHTMLFullEntities` декодирует все HTML-сущности.\n *\n * Если вам нужно декодировать не все сущности, используйте\n * {@link decodeHTMLEntities} и кастомный словарь.\n *\n * @param input текст который необходимо декодировать\n */\nexport function decodeHTMLFullEntities(input: string): string {\n  buildFullNamedEntities();\n\n  return decodeString(input, fullNamedEntities);\n}\n"],"names":["decodeHTMLEntities","decodeHTMLEntitiesDeep","decodeHTMLFullEntities","encodeHTMLEntities","escape","outOfBoundsChar","unescape","escapeReplacer","Replacer","unescapeReplacer","namedEntities","input","replace","String","fromCharCode","ENCODE_REGEX","entity","code","length","getCodePointAt","charCodeAt","DECODE_REGEX","decodeString","entities","secondChar","charAt","parseInt","substr","toLowerCase","fromCodePoint","numericUnicodeMap","slice","correctType","Object","prototype","toString","apply","map","item","response","keys","forEach","buildFullNamedEntities","fullNamedEntities"],"mappings":"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"}