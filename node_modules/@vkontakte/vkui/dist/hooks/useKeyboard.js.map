{"version":3,"sources":["../../src/hooks/useKeyboard.ts"],"sourcesContent":["import * as React from 'react';\nimport { useDOM } from '../lib/dom';\nimport { useGlobalEventListener } from './useGlobalEventListener';\n\ninterface SoftwareKeyboardState {\n  isOpened: boolean;\n}\n\n/**\n Проверяет, закрыла ли клавиатура часть экрана, 24% подошло к большинству устройств\n Работает на iOS и Android, где софт-клавиатура ресайзит viewport в браузерах\n */\nexport function getPreciseKeyboardState(window: any): boolean {\n  const {\n    innerHeight,\n    screen: { availHeight },\n  } = window;\n\n  const coveredViewportPercentage = Math.round((1 - innerHeight / availHeight) * 100);\n  return coveredViewportPercentage > 24;\n}\n\nconst eventOptions = {\n  passive: true,\n  capture: false,\n};\n\nexport function useKeyboard(): SoftwareKeyboardState {\n  const { document } = useDOM();\n\n  const [isOpened, setIsOpened] = React.useState(false);\n\n  const onFocus = React.useCallback(\n    (event: FocusEvent | true) => {\n      const isOpened =\n        (event === true || event.type === 'focusin') &&\n        (document?.activeElement?.tagName === 'INPUT' ||\n          document?.activeElement?.tagName === 'TEXTAREA');\n      setIsOpened(isOpened);\n    },\n    [document?.activeElement?.tagName],\n  );\n\n  /**\n   У полей с autoFocus не отлавливаются события focus, для этого вызываем вручную,\n   чтобы иметь хоть какое-то понимание происходящего.\n   */\n  React.useEffect(() => {\n    onFocus(true);\n  }, [onFocus]);\n\n  useGlobalEventListener(document, 'focusout', onFocus, eventOptions);\n  useGlobalEventListener(document, 'focusin', onFocus, eventOptions);\n\n  return { isOpened };\n}\n"],"names":["React","useDOM","useGlobalEventListener","getPreciseKeyboardState","window","innerHeight","screen","availHeight","coveredViewportPercentage","Math","round","eventOptions","passive","capture","useKeyboard","document","isOpened","setIsOpened","useState","onFocus","useCallback","event","type","activeElement","tagName","useEffect"],"mappings":"AAAA,YAAYA,WAAW,QAAQ;AAC/B,SAASC,MAAM,QAAQ,aAAa;AACpC,SAASC,sBAAsB,QAAQ,2BAA2B;AAMlE;;;CAGC,GACD,OAAO,SAASC,wBAAwBC,MAAW;IACjD,MAAM,EACJC,WAAW,EACXC,QAAQ,EAAEC,WAAW,EAAE,EACxB,GAAGH;IAEJ,MAAMI,4BAA4BC,KAAKC,KAAK,CAAC,AAAC,CAAA,IAAIL,cAAcE,WAAU,IAAK;IAC/E,OAAOC,4BAA4B;AACrC;AAEA,MAAMG,eAAe;IACnBC,SAAS;IACTC,SAAS;AACX;AAEA,OAAO,SAASC;QAaXC;IAZH,MAAM,EAAEA,QAAQ,EAAE,GAAGd;IAErB,MAAM,CAACe,UAAUC,YAAY,GAAGjB,MAAMkB,QAAQ,CAAC;IAE/C,MAAMC,UAAUnB,MAAMoB,WAAW,CAC/B,CAACC;YAGIN,yBACCA;QAHJ,MAAMC,WACJ,AAACK,CAAAA,UAAU,QAAQA,MAAMC,IAAI,KAAK,SAAQ,KACzCP,CAAAA,CAAAA,qBAAAA,gCAAAA,0BAAAA,SAAUQ,aAAa,cAAvBR,8CAAAA,wBAAyBS,OAAO,MAAK,WACpCT,CAAAA,qBAAAA,gCAAAA,2BAAAA,SAAUQ,aAAa,cAAvBR,+CAAAA,yBAAyBS,OAAO,MAAK,UAAS;QAClDP,YAAYD;IACd,GACA;QAACD,qBAAAA,gCAAAA,0BAAAA,SAAUQ,aAAa,cAAvBR,8CAAAA,wBAAyBS,OAAO;KAAC;IAGpC;;;GAGC,GACDxB,MAAMyB,SAAS,CAAC;QACdN,QAAQ;IACV,GAAG;QAACA;KAAQ;IAEZjB,uBAAuBa,UAAU,YAAYI,SAASR;IACtDT,uBAAuBa,UAAU,WAAWI,SAASR;IAErD,OAAO;QAAEK;IAAS;AACpB"}