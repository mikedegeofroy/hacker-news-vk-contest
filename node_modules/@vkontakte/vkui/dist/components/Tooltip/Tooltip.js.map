{"version":3,"sources":["../../../src/components/Tooltip/Tooltip.tsx"],"sourcesContent":["import * as React from 'react';\nimport { classNames, hasReactNode } from '@vkontakte/vkjs';\nimport { getWindow } from '@vkontakte/vkui-floating-ui/utils/dom';\nimport { useExternRef } from '../../hooks/useExternRef';\nimport { usePatchChildren } from '../../hooks/usePatchChildren';\nimport { Keys, pressedKey } from '../../lib/accessibility';\nimport { animationFadeClassNames } from '../../lib/cssAnimation';\nimport {\n  type FloatingComponentProps,\n  getArrowCoordsByMiddlewareData,\n  useFloatingMiddlewaresBootstrap,\n  useFloatingWithInteractions,\n  usePlacementChangeCallback,\n} from '../../lib/floating';\nimport { useIsomorphicLayoutEffect } from '../../lib/useIsomorphicLayoutEffect';\nimport { AppRootPortal } from '../AppRoot/AppRootPortal';\nimport { TooltipBase, type TooltipBaseProps } from '../TooltipBase/TooltipBase';\nimport { Subhead } from '../Typography/Subhead/Subhead';\n\ntype AllowedFloatingComponentProps = Pick<\n  FloatingComponentProps,\n  | 'arrowHeight'\n  | 'arrowPadding'\n  | 'hoverDelay'\n  | 'placement'\n  | 'offsetByMainAxis'\n  | 'offsetByCrossAxis'\n  | 'defaultShown'\n  | 'onShownChange'\n  | 'hideWhenReferenceHidden'\n  | 'children'\n  | 'zIndex'\n  | 'usePortal'\n  | 'onPlacementChange'\n>;\n\ntype AllowedTooltipBaseProps = Omit<TooltipBaseProps, 'arrowProps'>;\n\nexport interface TooltipProps extends AllowedFloatingComponentProps, AllowedTooltipBaseProps {\n  /**\n   * Передача `boolean` позволяет контролировать состояния показа и скрытия вручную. Используйте\n   * совместно с `onShawnChange`.\n   *\n   * > Если нужно разово инициировать показ тултипа при первом рендере, то используйте `defaultShown`.\n   */\n  shown?: boolean;\n  /**\n   * Добавляет возможность наводить на тултип.\n   */\n  enableInteractive?: boolean;\n  /**\n   * Скрывает стрелку, указывающую на якорный элемент.\n   */\n  disableArrow?: boolean;\n  /**\n   * Отключает закрытие по клику.\n   */\n  disableCloseAfterClick?: boolean;\n}\n\n/**\n * @see https://vkcom.github.io/VKUI/#/Tooltip\n */\nexport const Tooltip = ({\n  // UseFloatingMiddlewaresBootstrapOptions\n  placement: placementProp = 'bottom',\n  arrowPadding = 10,\n  arrowHeight = 8,\n  offsetByMainAxis = 8,\n  offsetByCrossAxis = 0,\n  hideWhenReferenceHidden,\n\n  // useFloatingWithInteractions\n  defaultShown,\n  shown: shownProp,\n  onShownChange,\n  hoverDelay = 150,\n\n  // инверсированные св-ва для useFloatingWithInteractions\n  enableInteractive = false,\n  disableArrow = false,\n  disableCloseAfterClick = false,\n\n  // Reference\n  children,\n\n  // AppRootProps\n  usePortal,\n\n  // TooltipBaseProps\n  id: idProp,\n  getRootRef,\n  text,\n  header,\n  appearance = 'neutral',\n  style: styleProp,\n  className,\n  zIndex = 'var(--vkui--z_index_popout)',\n  onPlacementChange,\n  ...popperProps\n}: TooltipProps) => {\n  const generatedId = React.useId();\n  const tooltipId = idProp || generatedId;\n\n  const [arrowRef, setArrowRef] = React.useState<HTMLDivElement | null>(null);\n  const { middlewares, strictPlacement } = useFloatingMiddlewaresBootstrap({\n    placement: placementProp,\n\n    offsetByMainAxis,\n    offsetByCrossAxis,\n\n    hideWhenReferenceHidden,\n\n    arrow: !disableArrow,\n    arrowRef,\n    arrowPadding,\n    arrowHeight,\n  });\n  const {\n    shown,\n    willBeHide,\n    placement,\n    refs,\n    referenceProps,\n    floatingProps,\n    middlewareData,\n    onEscapeKeyDown,\n  } = useFloatingWithInteractions({\n    defaultShown,\n    shown: shownProp,\n    onShownChange,\n    placement: strictPlacement,\n    trigger: ['hover', 'focus'],\n    hoverDelay,\n    closeAfterClick: !disableCloseAfterClick,\n    disableInteractive: !enableInteractive,\n    middlewares,\n  });\n  const tooltipRef = useExternRef<HTMLDivElement>(getRootRef, refs.setFloating);\n\n  usePlacementChangeCallback(placement, onPlacementChange);\n\n  let tooltip: React.ReactNode = null;\n  if (shown) {\n    referenceProps['aria-describedby'] = tooltipId;\n    floatingProps.style.zIndex = zIndex;\n    if (styleProp) {\n      Object.assign(floatingProps.style, styleProp);\n    }\n    tooltip = (\n      <AppRootPortal usePortal={usePortal}>\n        <TooltipBase\n          {...popperProps}\n          {...floatingProps}\n          id={tooltipId}\n          getRootRef={tooltipRef}\n          appearance={appearance}\n          arrowProps={\n            disableArrow\n              ? undefined\n              : {\n                  placement,\n                  coords: getArrowCoordsByMiddlewareData(middlewareData),\n                  getRootRef: setArrowRef,\n                }\n          }\n          text={\n            <React.Fragment>\n              {hasReactNode(header) && <Subhead weight=\"2\">{header}</Subhead>}\n              {hasReactNode(text) && <Subhead>{text}</Subhead>}\n            </React.Fragment>\n          }\n          className={classNames(\n            willBeHide ? animationFadeClassNames.out : animationFadeClassNames.in,\n            className,\n          )}\n        />\n      </AppRootPortal>\n    );\n  }\n  const [childRef, child] = usePatchChildren(children, referenceProps, refs.setReference);\n\n  useIsomorphicLayoutEffect(\n    function handleGlobalKeyDownIfTooltipShown() {\n      if (!onEscapeKeyDown || !shown) {\n        return;\n      }\n      const handleKeyDown = (event: KeyboardEvent) => {\n        if (pressedKey(event) === Keys.ESCAPE) {\n          onEscapeKeyDown();\n        }\n      };\n      const doc = getWindow(childRef.current).document;\n      doc.addEventListener('keydown', handleKeyDown, { passive: true, capture: true });\n      return () => {\n        doc.removeEventListener('keydown', handleKeyDown, { capture: true });\n      };\n    },\n    [shown, childRef, onEscapeKeyDown],\n  );\n\n  return (\n    <React.Fragment>\n      {child}\n      {tooltip}\n    </React.Fragment>\n  );\n};\n"],"names":["React","classNames","hasReactNode","getWindow","useExternRef","usePatchChildren","Keys","pressedKey","animationFadeClassNames","getArrowCoordsByMiddlewareData","useFloatingMiddlewaresBootstrap","useFloatingWithInteractions","usePlacementChangeCallback","useIsomorphicLayoutEffect","AppRootPortal","TooltipBase","Subhead","Tooltip","placement","placementProp","arrowPadding","arrowHeight","offsetByMainAxis","offsetByCrossAxis","hideWhenReferenceHidden","defaultShown","shown","shownProp","onShownChange","hoverDelay","enableInteractive","disableArrow","disableCloseAfterClick","children","usePortal","id","idProp","getRootRef","text","header","appearance","style","styleProp","className","zIndex","onPlacementChange","popperProps","generatedId","useId","tooltipId","arrowRef","setArrowRef","useState","middlewares","strictPlacement","arrow","willBeHide","refs","referenceProps","floatingProps","middlewareData","onEscapeKeyDown","trigger","closeAfterClick","disableInteractive","tooltipRef","setFloating","tooltip","Object","assign","arrowProps","undefined","coords","Fragment","weight","out","in","childRef","child","setReference","handleGlobalKeyDownIfTooltipShown","handleKeyDown","event","ESCAPE","doc","current","document","addEventListener","passive","capture","removeEventListener"],"mappings":"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"}