{"version":3,"sources":["../../../src/components/Popover/Popover.tsx"],"sourcesContent":["import * as React from 'react';\nimport { classNames } from '@vkontakte/vkjs';\nimport { usePatchChildren } from '../../hooks/usePatchChildren';\nimport { injectAriaExpandedPropByRole } from '../../lib/accessibility';\nimport { animationFadeClassNames, transformOriginClassNames } from '../../lib/cssAnimation';\nimport {\n  type FloatingComponentProps,\n  type FloatingContentRenderProp,\n  type OnShownChange,\n  useFloatingMiddlewaresBootstrap,\n  useFloatingWithInteractions,\n  usePlacementChangeCallback,\n} from '../../lib/floating';\nimport type { HTMLAttributesWithRootRef } from '../../types';\nimport { AppRootPortal } from '../AppRoot/AppRootPortal';\nimport { FocusTrap } from '../FocusTrap/FocusTrap';\nimport styles from './Popover.module.css';\n\n/**\n * @alias\n * @public\n */\nexport type PopoverOnShownChange = OnShownChange;\n\n/**\n * @alias\n * @public\n */\nexport type PopoverContentRenderProp = FloatingContentRenderProp;\n\ntype AllowedFloatingComponentProps = Pick<\n  FloatingComponentProps,\n  | 'placement'\n  | 'onPlacementChange'\n  | 'trigger'\n  | 'content'\n  | 'hoverDelay'\n  | 'closeAfterClick'\n  | 'offsetByMainAxis'\n  | 'offsetByCrossAxis'\n  | 'defaultShown'\n  | 'shown'\n  | 'onShownChange'\n  | 'usePortal'\n  | 'sameWidth'\n  | 'hideWhenReferenceHidden'\n  | 'disabled'\n  | 'disableInteractive'\n  | 'disableCloseOnClickOutside'\n  | 'disableCloseOnEscKey'\n  | 'autoFocus'\n  | 'restoreFocus'\n  | 'children'\n  | 'zIndex'\n>;\n\n/**\n * @public\n */\nexport interface PopoverProps\n  extends AllowedFloatingComponentProps,\n    Omit<HTMLAttributesWithRootRef<HTMLDivElement>, keyof FloatingComponentProps> {\n  /**\n   * Отключает у всплывающего элемента стилизацию по умолчанию, а именно:\n   * - background\n   * - border-radius\n   * - box-shadow\n   *\n   * Используется в случае, если необходимо стилизовать по своему.\n   */\n  noStyling?: boolean;\n}\n\n/**\n * @see https://vkcom.github.io/VKUI/#/Popover\n */\nexport const Popover = ({\n  // UsePopoverProps\n  placement: expectedPlacement = 'bottom-start',\n  onPlacementChange,\n  trigger = 'click',\n  content,\n  hoverDelay = 150,\n  closeAfterClick,\n  offsetByMainAxis = 8,\n  offsetByCrossAxis = 0,\n  sameWidth,\n  hideWhenReferenceHidden,\n  disabled,\n  disableInteractive,\n  disableCloseOnClickOutside,\n  disableCloseOnEscKey,\n  // uncontrolled\n  defaultShown = false,\n  // controlled\n  shown: shownProp,\n  onShownChange,\n\n  // Для AppRootPortal\n  usePortal = true,\n\n  // FocusTrapProps\n  autoFocus = true,\n  restoreFocus = true,\n  className,\n  children,\n  noStyling = false,\n  zIndex = 'var(--vkui--z_index_popout)',\n  // a11y\n  role,\n  ...restPopoverProps\n}: PopoverProps) => {\n  const { middlewares, strictPlacement } = useFloatingMiddlewaresBootstrap({\n    placement: expectedPlacement,\n    offsetByMainAxis,\n    offsetByCrossAxis,\n    sameWidth,\n    hideWhenReferenceHidden,\n  });\n  const {\n    placement,\n    shown,\n    willBeHide,\n    refs,\n    referenceProps,\n    floatingProps,\n    onClose,\n    onRestoreFocus,\n    onEscapeKeyDown,\n  } = useFloatingWithInteractions({\n    middlewares,\n    placement: strictPlacement,\n    trigger,\n    hoverDelay,\n    closeAfterClick,\n    disabled,\n    disableInteractive,\n    disableCloseOnClickOutside,\n    disableCloseOnEscKey,\n    defaultShown,\n    shown: shownProp,\n    onShownChange,\n  });\n\n  usePlacementChangeCallback(placement, onPlacementChange);\n\n  const [, child] = usePatchChildren<HTMLDivElement>(\n    children,\n    injectAriaExpandedPropByRole(referenceProps, shown, role),\n    refs.setReference,\n  );\n\n  let popover: React.ReactNode = null;\n  if (shown) {\n    floatingProps.style.zIndex = String(zIndex);\n    popover = (\n      <AppRootPortal usePortal={usePortal}>\n        <div ref={refs.setFloating} className={styles['Popover']} {...floatingProps}>\n          <FocusTrap\n            {...restPopoverProps}\n            role={role}\n            className={classNames(\n              styles['Popover__in'],\n              noStyling ? undefined : styles['Popover__in--withStyling'],\n              willBeHide ? animationFadeClassNames.out : animationFadeClassNames.in,\n              transformOriginClassNames[placement],\n              className,\n            )}\n            autoFocus={disableInteractive ? false : autoFocus}\n            restoreFocus={restoreFocus ? onRestoreFocus : false}\n            onClose={onEscapeKeyDown}\n          >\n            {typeof content === 'function' ? content({ onClose }) : content}\n          </FocusTrap>\n        </div>\n      </AppRootPortal>\n    );\n  }\n\n  return (\n    <React.Fragment>\n      {child}\n      {popover}\n    </React.Fragment>\n  );\n};\n"],"names":["React","classNames","usePatchChildren","injectAriaExpandedPropByRole","animationFadeClassNames","transformOriginClassNames","useFloatingMiddlewaresBootstrap","useFloatingWithInteractions","usePlacementChangeCallback","AppRootPortal","FocusTrap","Popover","placement","expectedPlacement","onPlacementChange","trigger","content","hoverDelay","closeAfterClick","offsetByMainAxis","offsetByCrossAxis","sameWidth","hideWhenReferenceHidden","disabled","disableInteractive","disableCloseOnClickOutside","disableCloseOnEscKey","defaultShown","shown","shownProp","onShownChange","usePortal","autoFocus","restoreFocus","className","children","noStyling","zIndex","role","restPopoverProps","middlewares","strictPlacement","willBeHide","refs","referenceProps","floatingProps","onClose","onRestoreFocus","onEscapeKeyDown","child","setReference","popover","style","String","div","ref","setFloating","undefined","out","in","Fragment"],"mappings":";;;AAAA,YAAYA,WAAW,QAAQ;AAC/B,SAASC,UAAU,QAAQ,kBAAkB;AAC7C,SAASC,gBAAgB,QAAQ,+BAA+B;AAChE,SAASC,4BAA4B,QAAQ,0BAA0B;AACvE,SAASC,uBAAuB,EAAEC,yBAAyB,QAAQ,yBAAyB;AAC5F,SAIEC,+BAA+B,EAC/BC,2BAA2B,EAC3BC,0BAA0B,QACrB,qBAAqB;AAE5B,SAASC,aAAa,QAAQ,2BAA2B;AACzD,SAASC,SAAS,QAAQ,yBAAyB;AA0DnD;;CAEC,GACD,OAAO,MAAMC,UAAU;QAAC,EACtB,kBAAkB;IAClBC,WAAWC,oBAAoB,cAAc,EAC7CC,iBAAiB,EACjBC,UAAU,OAAO,EACjBC,OAAO,EACPC,aAAa,GAAG,EAChBC,eAAe,EACfC,mBAAmB,CAAC,EACpBC,oBAAoB,CAAC,EACrBC,SAAS,EACTC,uBAAuB,EACvBC,QAAQ,EACRC,kBAAkB,EAClBC,0BAA0B,EAC1BC,oBAAoB,EACpB,eAAe;IACfC,eAAe,KAAK,EACpB,aAAa;IACbC,OAAOC,SAAS,EAChBC,aAAa,EAEb,oBAAoB;IACpBC,YAAY,IAAI,EAEhB,iBAAiB;IACjBC,YAAY,IAAI,EAChBC,eAAe,IAAI,EACnBC,SAAS,EACTC,QAAQ,EACRC,YAAY,KAAK,EACjBC,SAAS,6BAA6B,EACtC,OAAO;IACPC,IAAI,EAES,WADVC;QAhCH3B;QACAE;QACAC;QACAC;QACAC;QACAC;QACAC;QACAC;QACAC;QACAC;QACAC;QACAC;QACAC;QACAC;QAEAC;QAEAC;QACAE;QAGAC;QAGAC;QACAC;QACAC;QACAC;QACAC;QACAC;QAEAC;;IAGA,MAAM,EAAEE,WAAW,EAAEC,eAAe,EAAE,GAAGnC,gCAAgC;QACvEM,WAAWC;QACXM;QACAC;QACAC;QACAC;IACF;IACA,MAAM,EACJV,SAAS,EACTgB,KAAK,EACLc,UAAU,EACVC,IAAI,EACJC,cAAc,EACdC,aAAa,EACbC,OAAO,EACPC,cAAc,EACdC,eAAe,EAChB,GAAGzC,4BAA4B;QAC9BiC;QACA5B,WAAW6B;QACX1B;QACAE;QACAC;QACAK;QACAC;QACAC;QACAC;QACAC;QACAC,OAAOC;QACPC;IACF;IAEAtB,2BAA2BI,WAAWE;IAEtC,MAAM,GAAGmC,MAAM,GAAG/C,iBAChBiC,UACAhC,6BAA6ByC,gBAAgBhB,OAAOU,OACpDK,KAAKO,YAAY;IAGnB,IAAIC,UAA2B;IAC/B,IAAIvB,OAAO;QACTiB,cAAcO,KAAK,CAACf,MAAM,GAAGgB,OAAOhB;QACpCc,wBACE,oBAAC1C;YAAcsB,WAAWA;yBACxB,oBAACuB;YAAIC,KAAKZ,KAAKa,WAAW;YAAEtB,SAAS;WAAyBW,8BAC5D,oBAACnC,mDACK6B;YACJD,MAAMA;YACNJ,WAAWjC,8BAETmC,YAAYqB,4CACZf,aAAatC,wBAAwBsD,GAAG,GAAGtD,wBAAwBuD,EAAE,EACrEtD,yBAAyB,CAACO,UAAU,EACpCsB;YAEFF,WAAWR,qBAAqB,QAAQQ;YACxCC,cAAcA,eAAec,iBAAiB;YAC9CD,SAASE;YAER,OAAOhC,YAAY,aAAaA,QAAQ;YAAE8B;QAAQ,KAAK9B;IAKlE;IAEA,qBACE,oBAAChB,MAAM4D,QAAQ,QACZX,OACAE;AAGP,EAAE"}