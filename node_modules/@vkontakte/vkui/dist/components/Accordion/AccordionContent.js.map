{"version":3,"sources":["../../../src/components/Accordion/AccordionContent.tsx"],"sourcesContent":["import * as React from 'react';\nimport { classNames } from '@vkontakte/vkjs';\nimport { useExternRef } from '../../hooks/useExternRef';\nimport { useGlobalEventListener } from '../../hooks/useGlobalEventListener';\nimport { useDOM } from '../../lib/dom';\nimport { useIsomorphicLayoutEffect } from '../../lib/useIsomorphicLayoutEffect';\nimport { HasRef, HasRootRef } from '../../types';\nimport { AccordionContext } from './AccordionContext';\nimport styles from './Accordion.module.css';\n\n/**\n * Функция расчета max-height, для скрытия или раскрытия контента.\n */\nfunction calcMaxHeight(expanded: boolean, el: HTMLElement | null): string {\n  if (!expanded) {\n    return '0px';\n  }\n\n  // В первый рендеринг нельзя узнать высоту элемента\n  if (el === null) {\n    return 'inherit';\n  }\n\n  return `${el.scrollHeight}px`;\n}\n\n/**\n * Хук для отслеживания изменения высоты контента.\n */\nfunction useResizeContent(expanded: boolean, inRef: React.MutableRefObject<HTMLDivElement | null>) {\n  const resize = () => {\n    inRef.current!.style.maxHeight = calcMaxHeight(expanded, inRef.current);\n  };\n\n  const { window } = useDOM();\n  useGlobalEventListener(window, 'resize', resize);\n  useIsomorphicLayoutEffect(resize, []);\n}\n\n/**\n * Хук для скрывания или раскрывания контента. Возвращает стили для in элемента.\n */\nfunction useAccordionContent(\n  expanded: boolean,\n  inRef: React.MutableRefObject<HTMLDivElement | null>,\n) {\n  const maxHeight = calcMaxHeight(expanded, inRef.current);\n\n  useResizeContent(expanded, inRef);\n\n  return { maxHeight };\n}\n\nexport interface AccordionContentProps\n  extends HasRootRef<HTMLDivElement>,\n    HasRef<HTMLDivElement>,\n    React.HTMLAttributes<HTMLDivElement> {}\n\nexport const AccordionContent = ({\n  getRootRef,\n  getRef,\n  className,\n  children,\n  ...restProps\n}: AccordionContentProps) => {\n  const inRef = useExternRef(getRef);\n  const { expanded, labelId, contentId } = React.useContext(AccordionContext);\n\n  const inStyle = useAccordionContent(expanded, inRef);\n\n  return (\n    <div\n      ref={getRootRef}\n      id={contentId}\n      role=\"region\"\n      aria-labelledby={labelId}\n      aria-hidden={!expanded}\n      className={classNames(styles['AccordionContent'], className)}\n      {...restProps}\n    >\n      <div ref={inRef} className={styles['AccordionContent__in']} style={inStyle}>\n        {children}\n      </div>\n    </div>\n  );\n};\n"],"names":["React","classNames","useExternRef","useGlobalEventListener","useDOM","useIsomorphicLayoutEffect","AccordionContext","calcMaxHeight","expanded","el","scrollHeight","useResizeContent","inRef","resize","current","style","maxHeight","window","useAccordionContent","AccordionContent","getRootRef","getRef","className","children","restProps","labelId","contentId","useContext","inStyle","div","ref","id","role","aria-labelledby","aria-hidden"],"mappings":";;AAAA,YAAYA,WAAW,QAAQ;AAC/B,SAASC,UAAU,QAAQ,kBAAkB;AAC7C,SAASC,YAAY,QAAQ,2BAA2B;AACxD,SAASC,sBAAsB,QAAQ,qCAAqC;AAC5E,SAASC,MAAM,QAAQ,gBAAgB;AACvC,SAASC,yBAAyB,QAAQ,sCAAsC;AAEhF,SAASC,gBAAgB,QAAQ,qBAAqB;AAGtD;;CAEC,GACD,SAASC,cAAcC,QAAiB,EAAEC,EAAsB;IAC9D,IAAI,CAACD,UAAU;QACb,OAAO;IACT;IAEA,mDAAmD;IACnD,IAAIC,OAAO,MAAM;QACf,OAAO;IACT;IAEA,OAAO,CAAC,EAAEA,GAAGC,YAAY,CAAC,EAAE,CAAC;AAC/B;AAEA;;CAEC,GACD,SAASC,iBAAiBH,QAAiB,EAAEI,KAAoD;IAC/F,MAAMC,SAAS;QACbD,MAAME,OAAO,CAAEC,KAAK,CAACC,SAAS,GAAGT,cAAcC,UAAUI,MAAME,OAAO;IACxE;IAEA,MAAM,EAAEG,MAAM,EAAE,GAAGb;IACnBD,uBAAuBc,QAAQ,UAAUJ;IACzCR,0BAA0BQ,QAAQ,EAAE;AACtC;AAEA;;CAEC,GACD,SAASK,oBACPV,QAAiB,EACjBI,KAAoD;IAEpD,MAAMI,YAAYT,cAAcC,UAAUI,MAAME,OAAO;IAEvDH,iBAAiBH,UAAUI;IAE3B,OAAO;QAAEI;IAAU;AACrB;AAOA,OAAO,MAAMG,mBAAmB;QAAC,EAC/BC,UAAU,EACVC,MAAM,EACNC,SAAS,EACTC,QAAQ,EAEc,WADnBC;QAJHJ;QACAC;QACAC;QACAC;;IAGA,MAAMX,QAAQV,aAAamB;IAC3B,MAAM,EAAEb,QAAQ,EAAEiB,OAAO,EAAEC,SAAS,EAAE,GAAG1B,MAAM2B,UAAU,CAACrB;IAE1D,MAAMsB,UAAUV,oBAAoBV,UAAUI;IAE9C,qBACE,oBAACiB;QACCC,KAAKV;QACLW,IAAIL;QACJM,MAAK;QACLC,mBAAiBR;QACjBS,eAAa,CAAC1B;QACdc,WAAWrB,mCAAuCqB;OAC9CE,0BAEJ,oBAACK;QAAIC,KAAKlB;QAAOU,SAAS;QAAkCP,OAAOa;OAChEL;AAIT,EAAE"}