{"version":3,"sources":["../../src/lib/accessibility.ts"],"sourcesContent":["import * as React from 'react';\nimport { HasChildren, ValuesOfObject } from '../types';\nimport { getTextFromChildren } from './children';\n\nexport const FOCUSABLE_ELEMENTS_LIST = [\n  'a[href]',\n  'area[href]',\n  'input:not([disabled]):not([hidden]):not([type=\"hidden\"]):not([aria-hidden])',\n  'select:not([disabled]):not([hidden]):not([aria-hidden])',\n  'textarea:not([disabled])',\n  'button:not([disabled])',\n  'iframe',\n  'audio',\n  'video',\n  '[contenteditable]',\n  '[tabindex]:not([tabindex=\"-1\"])',\n];\n\nexport const Keys = {\n  ENTER: 'Enter',\n  SPACE: 'Space',\n  TAB: 'Tab',\n  ESCAPE: 'Escape',\n  HOME: 'Home',\n  END: 'End',\n  DELETE: 'Delete',\n  BACKSPACE: 'Backspace',\n  ARROW_LEFT: 'ArrowLeft',\n  ARROW_RIGHT: 'ArrowRight',\n  ARROW_UP: 'ArrowUp',\n  ARROW_DOWN: 'ArrowDown',\n  PAGE_UP: 'PageUp',\n  PAGE_DOWN: 'PageDown',\n} as const;\n\nexport type KeysValues = ValuesOfObject<typeof Keys>;\n\nconst EVENT_KEY_TO_COMMON_KEY_MAP = new Map([\n  ['Enter', Keys.ENTER],\n  ['Space', Keys.SPACE],\n  ['Spacebar', Keys.SPACE],\n  [' ', Keys.SPACE],\n  ['Tab', Keys.TAB],\n  ['Escape', Keys.ESCAPE],\n  ['Home', Keys.HOME],\n  ['End', Keys.END],\n  ['ArrowLeft', Keys.ARROW_LEFT],\n  ['ArrowRight', Keys.ARROW_RIGHT],\n  ['ArrowUp', Keys.ARROW_UP],\n  ['ArrowDown', Keys.ARROW_DOWN],\n  ['PageUp', Keys.PAGE_UP],\n  ['PageDown', Keys.PAGE_DOWN],\n]);\n\nexport function pressedKey<T extends KeyboardEvent | React.KeyboardEvent>(event: T) {\n  const foundKey = EVENT_KEY_TO_COMMON_KEY_MAP.get(event.key);\n  return foundKey ? foundKey : null;\n}\n\nexport const FOCUS_ALLOW_LIST_KEYS = new Set<string>([\n  Keys.TAB,\n  Keys.ARROW_LEFT,\n  Keys.ARROW_RIGHT,\n  Keys.ARROW_UP,\n  Keys.ARROW_DOWN,\n  Keys.BACKSPACE,\n  Keys.DELETE,\n]);\n\nexport function isKeyboardFocusingStarted<T extends KeyboardEvent | React.KeyboardEvent>(event: T) {\n  return FOCUS_ALLOW_LIST_KEYS.has(event.key);\n}\n\nexport function shouldTriggerClickOnEnterOrSpace(\n  e: KeyboardEvent | React.KeyboardEvent<HTMLElement>,\n) {\n  const el = e.target as HTMLElement;\n  const { tagName } = el;\n\n  const role = el.getAttribute('role');\n\n  const isValidKeyboardEventTarget: boolean =\n    el.isContentEditable !== true &&\n    tagName !== 'INPUT' &&\n    tagName !== 'TEXTAREA' &&\n    (role === 'button' || role === 'link' || role === 'menuitem');\n\n  const isNativeAnchorEl = tagName === 'A' && el.hasAttribute('href');\n  const keyPressed = pressedKey(e);\n\n  return (\n    isValidKeyboardEventTarget &&\n    // trigger buttons on Space\n    ((keyPressed === Keys.SPACE && role === 'button') ||\n      // trigger non-native links and buttons on Enter\n      (keyPressed === Keys.ENTER && !isNativeAnchorEl))\n  );\n}\n\n/**\n * @see https://doka.guide/a11y/aria-expanded/\n */\nexport const injectAriaExpandedPropByRole = (\n  props: React.ComponentProps<any>,\n  state: boolean,\n  role?: React.AriaRole,\n) => {\n  switch (role) {\n    case 'menu':\n    case 'application':\n    case 'tab':\n    case 'menuitem':\n    case 'treeitem':\n    case 'gridcell':\n      props['aria-expanded'] = state;\n      return props;\n    default:\n      return props;\n  }\n};\n\ninterface HasAccessibleNameProps\n  extends Pick<React.AriaAttributes, 'aria-label' | 'aria-labelledby'>,\n    HasChildren {\n  title?: string;\n}\n\nexport function hasAccessibleName({\n  'aria-label': ariaLabel,\n  'aria-labelledby': ariaLabelledBy,\n  title,\n  children,\n}: HasAccessibleNameProps) {\n  if (ariaLabel || ariaLabelledBy || title) {\n    return true;\n  }\n\n  const accessibleLabel = getTextFromChildren(children);\n\n  if (accessibleLabel.trim() !== '') {\n    return true;\n  }\n\n  return false;\n}\n\n/**\n * @private\n */\nexport const getHorizontalFocusGoTo = (\n  keys: Extract<KeysValues, 'ArrowUp' | 'ArrowLeft' | 'ArrowDown' | 'ArrowRight'>,\n) => {\n  switch (keys) {\n    case Keys.ARROW_UP:\n    case Keys.ARROW_LEFT:\n      return 'prev';\n    case Keys.ARROW_DOWN:\n    case Keys.ARROW_RIGHT:\n      return 'next';\n  }\n};\n"],"names":["React","getTextFromChildren","FOCUSABLE_ELEMENTS_LIST","Keys","ENTER","SPACE","TAB","ESCAPE","HOME","END","DELETE","BACKSPACE","ARROW_LEFT","ARROW_RIGHT","ARROW_UP","ARROW_DOWN","PAGE_UP","PAGE_DOWN","EVENT_KEY_TO_COMMON_KEY_MAP","Map","pressedKey","event","foundKey","get","key","FOCUS_ALLOW_LIST_KEYS","Set","isKeyboardFocusingStarted","has","shouldTriggerClickOnEnterOrSpace","e","el","target","tagName","role","getAttribute","isValidKeyboardEventTarget","isContentEditable","isNativeAnchorEl","hasAttribute","keyPressed","injectAriaExpandedPropByRole","props","state","hasAccessibleName","ariaLabel","ariaLabelledBy","title","children","accessibleLabel","trim","getHorizontalFocusGoTo","keys"],"mappings":"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"}