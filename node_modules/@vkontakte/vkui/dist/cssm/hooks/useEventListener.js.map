{"version":3,"sources":["../../../src/hooks/useEventListener.ts"],"sourcesContent":["import * as React from 'react';\nimport { noop } from '@vkontakte/vkjs';\nimport { canUseDOM } from '../lib/dom';\nimport { useIsomorphicLayoutEffect } from '../lib/useIsomorphicLayoutEffect';\n\ninterface EventListenerHandle {\n  add: (el: HTMLElement | Document | Window) => void;\n  remove: () => void;\n}\n\nexport function useEventListener<K extends keyof GlobalEventHandlersEventMap>(\n  event: K,\n  _cb: false | null | undefined | ((ev: GlobalEventHandlersEventMap[K]) => void),\n  _options?: AddEventListenerOptions,\n): EventListenerHandle;\nexport function useEventListener<E extends Event>(\n  event: string,\n  _cb: false | null | undefined | ((ev: E) => void),\n  _options?: AddEventListenerOptions,\n): EventListenerHandle;\nexport function useEventListener<E extends Event, K extends keyof GlobalEventHandlersEventMap>(\n  event: string | K,\n  _cb: false | null | undefined | ((ev: E) => void),\n  _options?: AddEventListenerOptions,\n): EventListenerHandle {\n  const cbRef = React.useRef(_cb);\n  useIsomorphicLayoutEffect(() => {\n    cbRef.current = _cb;\n  }, [_cb]);\n  const cb = React.useCallback((e: any) => cbRef.current && cbRef.current(e), []);\n\n  const detach = React.useRef(noop);\n  const remove = React.useCallback(() => {\n    detach.current();\n    detach.current = noop;\n  }, []);\n  const add = React.useCallback(\n    (el: HTMLElement | Document | Window) => {\n      if (!canUseDOM) {\n        return;\n      }\n      remove();\n      if (!el) {\n        return;\n      }\n      const options = { ..._options };\n      el.addEventListener(event, cb, options);\n      detach.current = () => el.removeEventListener(event, cb, options);\n    },\n    [_options, cb, event, remove],\n  );\n  React.useEffect(() => remove, [remove]);\n\n  return React.useMemo(() => ({ add, remove }), [add, remove]);\n}\n"],"names":["React","noop","canUseDOM","useIsomorphicLayoutEffect","useEventListener","event","_cb","_options","cbRef","useRef","current","cb","useCallback","e","detach","remove","add","el","options","addEventListener","removeEventListener","useEffect","useMemo"],"mappings":"AAAA,YAAYA,WAAW,QAAQ;AAC/B,SAASC,IAAI,QAAQ,kBAAkB;AACvC,SAASC,SAAS,QAAQ,aAAa;AACvC,SAASC,yBAAyB,QAAQ,mCAAmC;AAiB7E,OAAO,SAASC,iBACdC,KAAiB,EACjBC,GAAiD,EACjDC,QAAkC;IAElC,MAAMC,QAAQR,MAAMS,MAAM,CAACH;IAC3BH,0BAA0B;QACxBK,MAAME,OAAO,GAAGJ;IAClB,GAAG;QAACA;KAAI;IACR,MAAMK,KAAKX,MAAMY,WAAW,CAAC,CAACC,IAAWL,MAAME,OAAO,IAAIF,MAAME,OAAO,CAACG,IAAI,EAAE;IAE9E,MAAMC,SAASd,MAAMS,MAAM,CAACR;IAC5B,MAAMc,SAASf,MAAMY,WAAW,CAAC;QAC/BE,OAAOJ,OAAO;QACdI,OAAOJ,OAAO,GAAGT;IACnB,GAAG,EAAE;IACL,MAAMe,MAAMhB,MAAMY,WAAW,CAC3B,CAACK;QACC,IAAI,CAACf,WAAW;YACd;QACF;QACAa;QACA,IAAI,CAACE,IAAI;YACP;QACF;QACA,MAAMC,UAAU;YAAE,GAAGX,QAAQ;QAAC;QAC9BU,GAAGE,gBAAgB,CAACd,OAAOM,IAAIO;QAC/BJ,OAAOJ,OAAO,GAAG,IAAMO,GAAGG,mBAAmB,CAACf,OAAOM,IAAIO;IAC3D,GACA;QAACX;QAAUI;QAAIN;QAAOU;KAAO;IAE/Bf,MAAMqB,SAAS,CAAC,IAAMN,QAAQ;QAACA;KAAO;IAEtC,OAAOf,MAAMsB,OAAO,CAAC,IAAO,CAAA;YAAEN;YAAKD;QAAO,CAAA,GAAI;QAACC;QAAKD;KAAO;AAC7D"}