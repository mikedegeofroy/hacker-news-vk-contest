{"version":3,"sources":["../../../src/hooks/usePatchChildren.ts"],"sourcesContent":["import * as React from 'react';\nimport { getMergedSameEventsByProps } from '../helpers/getMergedSameEventsByProps';\nimport {\n  isDOMTypeElement,\n  isForwardRefElement,\n  isValidNotReactFragmentElement,\n} from '../lib/utils';\nimport { warnOnce } from '../lib/warnOnce';\nimport type { HasRootRef } from '../types';\nimport { useEffectDev } from './useEffectDev';\nimport { useExternRef } from './useExternRef';\n\nconst warn = warnOnce('usePatchChildrenRef');\n\ntype InjectProps<T> = Omit<React.HTMLAttributes<T>, keyof React.DOMAttributes<T>> &\n  React.Attributes & {\n    ref?: React.Ref<T>;\n  };\n\ntype ExpectedReactElement<T> = React.ReactElement<HasRootRef<T> & React.DOMAttributes<T>>;\n\ntype ChildrenElement<T> =\n  | ExpectedReactElement<T>\n  | React.ReactText\n  | React.ReactFragment\n  | React.ReactPortal\n  | boolean\n  | null\n  | undefined;\n\n/**\n * –§—É–Ω–∫—Ü–∏—è –ø—ã—Ç–∞–µ—Ç—Å—è –ø—Ä–æ–∫–∏–Ω—É—Ç—å –≤ –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã–π React-—ç–ª–µ–º–µ–Ω—Ç —Ö—É–∫ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –µ–≥–æ —Å—Å—ã–ª–∫–∏ –Ω–∞ DOM —ç—Ç–æ–≥–æ\n * —ç–ª–µ–º–µ–Ω—Ç–∞.\n *\n * @param children\n * @param injectProps\n * @param externRef ‚Äì –ø–æ–ª–µ–∑–µ–Ω –∫–æ–≥–¥–∞ –Ω—É–∂–Ω–æ –ø—Ä–æ–∫–∏–Ω—É—Ç—å `ref` —ç–ª–µ–º–µ–Ω—Ç—É –≤—ã—à–µ.\n *\n * üëé –ë–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ `externRef`\n * ```ts\n * const { ref } = useSomeHook();\n * const [childRef, child] = usePatchChildrenRef(children);\n * React.useLayoutEffect(() => {\n *   ref.current = childRef.current; // –∏–ª–∏ ref.current(childRef.current)\n * }, [childRef]);\n * ```\n *\n * üëç –° –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º `externRef`\n * ```ts\n * const { ref } = useSomeHook();\n * const [childRef, child] = usePatchChildrenRef(children, undefined, ref);\n * ```\n *\n * @private\n */\nexport const usePatchChildren = <ElementType extends HTMLElement = HTMLElement>(\n  children?: ChildrenElement<ElementType>,\n  injectProps?: InjectProps<ElementType>,\n  externRef?: React.Ref<ElementType>,\n): [React.MutableRefObject<ElementType | null>, ChildrenElement<ElementType> | undefined] => {\n  const isValidElementResult = isValidNotReactFragmentElement(children);\n  const isDOMTypeElementResult =\n    isValidElementResult &&\n    isDOMTypeElement<React.HTMLAttributes<ElementType>, ElementType>(children);\n\n  const isForwardedRefElementResult =\n    isValidElementResult &&\n    isForwardRefElement<React.HTMLAttributes<ElementType>, ElementType>(children);\n\n  const shouldUseRef = isDOMTypeElementResult || isForwardedRefElementResult;\n\n  const childRef = useExternRef<ElementType>(\n    shouldUseRef ? children.ref : isValidElementResult ? children.props.getRootRef : undefined,\n    externRef,\n  );\n\n  const mergedEventsByInjectProps = getMergedSameEventsByProps(\n    injectProps ? injectProps : {},\n    isValidElementResult ? children.props : {},\n  );\n\n  const props = shouldUseRef\n    ? { ref: childRef, ...injectProps, ...mergedEventsByInjectProps }\n    : isValidElementResult\n    ? { getRootRef: childRef, ...injectProps, ...mergedEventsByInjectProps }\n    : undefined;\n\n  useEffectDev(() => {\n    if (!childRef.current) {\n      warn(\n        '–ö–∞–∂–µ—Ç—Å—è, –≤ children –ø–µ—Ä–µ–¥–∞–Ω –∫–æ–º–ø–æ–Ω–µ–Ω—Ç, –∫–æ—Ç–æ—Ä—ã–π –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Å–≤–æ–π—Å—Ç–≤–æ getRootRef. –ú—ã –Ω–µ –º–æ–∂–µ–º –ø–æ–ª—É—á–∏—Ç—å —Å—Å—ã–ª–∫—É –Ω–∞ –∫–æ—Ä–Ω–µ–≤–æ–π dom-—ç–ª–µ–º–µ–Ω—Ç —ç—Ç–æ–≥–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞',\n        'error',\n      );\n    }\n  }, [isValidElementResult ? children.type : null, childRef]);\n\n  return [childRef, isValidElementResult ? React.cloneElement(children, props) : children];\n};\n"],"names":["React","getMergedSameEventsByProps","isDOMTypeElement","isForwardRefElement","isValidNotReactFragmentElement","warnOnce","useEffectDev","useExternRef","warn","usePatchChildren","children","injectProps","externRef","isValidElementResult","isDOMTypeElementResult","isForwardedRefElementResult","shouldUseRef","childRef","ref","props","getRootRef","undefined","mergedEventsByInjectProps","current","type","cloneElement"],"mappings":"AAAA,YAAYA,WAAW,QAAQ;AAC/B,SAASC,0BAA0B,QAAQ,wCAAwC;AACnF,SACEC,gBAAgB,EAChBC,mBAAmB,EACnBC,8BAA8B,QACzB,eAAe;AACtB,SAASC,QAAQ,QAAQ,kBAAkB;AAE3C,SAASC,YAAY,QAAQ,iBAAiB;AAC9C,SAASC,YAAY,QAAQ,iBAAiB;AAE9C,MAAMC,OAAOH,SAAS;AAkBtB;;;;;;;;;;;;;;;;;;;;;;;;CAwBC,GACD,OAAO,MAAMI,mBAAmB,CAC9BC,UACAC,aACAC;IAEA,MAAMC,uBAAuBT,+BAA+BM;IAC5D,MAAMI,yBACJD,wBACAX,iBAAiEQ;IAEnE,MAAMK,8BACJF,wBACAV,oBAAoEO;IAEtE,MAAMM,eAAeF,0BAA0BC;IAE/C,MAAME,WAAWV,aACfS,eAAeN,SAASQ,GAAG,GAAGL,uBAAuBH,SAASS,KAAK,CAACC,UAAU,GAAGC,WACjFT;IAGF,MAAMU,4BAA4BrB,2BAChCU,cAAcA,cAAc,CAAC,GAC7BE,uBAAuBH,SAASS,KAAK,GAAG,CAAC;IAG3C,MAAMA,QAAQH,eACV;QAAEE,KAAKD;QAAU,GAAGN,WAAW;QAAE,GAAGW,yBAAyB;IAAC,IAC9DT,uBACA;QAAEO,YAAYH;QAAU,GAAGN,WAAW;QAAE,GAAGW,yBAAyB;IAAC,IACrED;IAEJf,aAAa;QACX,IAAI,CAACW,SAASM,OAAO,EAAE;YACrBf,KACE,4JACA;QAEJ;IACF,GAAG;QAACK,uBAAuBH,SAASc,IAAI,GAAG;QAAMP;KAAS;IAE1D,OAAO;QAACA;QAAUJ,uBAAuBb,MAAMyB,YAAY,CAACf,UAAUS,SAAST;KAAS;AAC1F,EAAE"}