{"version":3,"sources":["../../../src/hooks/useWaitTransitionFinish.ts"],"sourcesContent":["import * as React from 'react';\nimport { noop } from '@vkontakte/vkjs';\nimport { useDOM } from '../lib/dom';\nimport { transitionEvent } from '../lib/supportEvents';\n\nexport const useWaitTransitionFinish = () => {\n  const timeoutRef = React.useRef<ReturnType<typeof setTimeout> | null>(null);\n  const { document } = useDOM();\n  const detach = React.useRef(noop);\n\n  const remove = React.useCallback(() => {\n    detach.current();\n    detach.current = noop;\n  }, []);\n\n  const waitTransitionFinish = React.useCallback(\n    (\n      element: HTMLElement | undefined | null,\n      eventHandler: VoidFunction,\n      durationFallback: number,\n    ) => {\n      if (element) {\n        if (!document?.hidden && transitionEvent.supported && transitionEvent.name) {\n          remove();\n          element.addEventListener(transitionEvent.name, eventHandler);\n          detach.current = () => {\n            if (transitionEvent.name) {\n              element.removeEventListener(transitionEvent.name, eventHandler);\n            }\n          };\n        } else {\n          if (timeoutRef?.current) {\n            clearTimeout(timeoutRef.current);\n          }\n          timeoutRef.current = setTimeout(eventHandler, durationFallback);\n        }\n      }\n    },\n    [document, remove, timeoutRef],\n  );\n\n  return {\n    waitTransitionFinish,\n  };\n};\n"],"names":["React","noop","useDOM","transitionEvent","useWaitTransitionFinish","timeoutRef","useRef","document","detach","remove","useCallback","current","waitTransitionFinish","element","eventHandler","durationFallback","hidden","supported","name","addEventListener","removeEventListener","clearTimeout","setTimeout"],"mappings":"AAAA,YAAYA,WAAW,QAAQ;AAC/B,SAASC,IAAI,QAAQ,kBAAkB;AACvC,SAASC,MAAM,QAAQ,aAAa;AACpC,SAASC,eAAe,QAAQ,uBAAuB;AAEvD,OAAO,MAAMC,0BAA0B;IACrC,MAAMC,aAAaL,MAAMM,MAAM,CAAuC;IACtE,MAAM,EAAEC,QAAQ,EAAE,GAAGL;IACrB,MAAMM,SAASR,MAAMM,MAAM,CAACL;IAE5B,MAAMQ,SAAST,MAAMU,WAAW,CAAC;QAC/BF,OAAOG,OAAO;QACdH,OAAOG,OAAO,GAAGV;IACnB,GAAG,EAAE;IAEL,MAAMW,uBAAuBZ,MAAMU,WAAW,CAC5C,CACEG,SACAC,cACAC;QAEA,IAAIF,SAAS;YACX,IAAI,CAACN,UAAUS,UAAUb,gBAAgBc,SAAS,IAAId,gBAAgBe,IAAI,EAAE;gBAC1ET;gBACAI,QAAQM,gBAAgB,CAAChB,gBAAgBe,IAAI,EAAEJ;gBAC/CN,OAAOG,OAAO,GAAG;oBACf,IAAIR,gBAAgBe,IAAI,EAAE;wBACxBL,QAAQO,mBAAmB,CAACjB,gBAAgBe,IAAI,EAAEJ;oBACpD;gBACF;YACF,OAAO;gBACL,IAAIT,YAAYM,SAAS;oBACvBU,aAAahB,WAAWM,OAAO;gBACjC;gBACAN,WAAWM,OAAO,GAAGW,WAAWR,cAAcC;YAChD;QACF;IACF,GACA;QAACR;QAAUE;QAAQJ;KAAW;IAGhC,OAAO;QACLO;IACF;AACF,EAAE"}