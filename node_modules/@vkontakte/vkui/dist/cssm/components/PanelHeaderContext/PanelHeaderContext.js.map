{"version":3,"sources":["../../../../src/components/PanelHeaderContext/PanelHeaderContext.tsx"],"sourcesContent":["import * as React from 'react';\nimport { classNames } from '@vkontakte/vkjs';\nimport { useAdaptivity } from '../../hooks/useAdaptivity';\nimport { useGlobalEventListener } from '../../hooks/useGlobalEventListener';\nimport { usePlatform } from '../../hooks/usePlatform';\nimport { useTimeout } from '../../hooks/useTimeout';\nimport { useDOM } from '../../lib/dom';\nimport { useIsomorphicLayoutEffect } from '../../lib/useIsomorphicLayoutEffect';\nimport { HTMLAttributesWithRootRef } from '../../types';\nimport { useScrollLock } from '../AppRoot/ScrollContext';\nimport { FixedLayout } from '../FixedLayout/FixedLayout';\nimport styles from './PanelHeaderContext.module.css';\n\nconst sizeXClassNames = {\n  none: styles['PanelHeaderContext--sizeX-none'],\n  ['compact']: styles['PanelHeaderContext--sizeX-compact'],\n  ['regular']: styles['PanelHeaderContext--sizeX-regular'],\n};\n\nexport interface PanelHeaderContextProps extends HTMLAttributesWithRootRef<HTMLDivElement> {\n  opened: boolean;\n  onClose: VoidFunction;\n}\n\n/**\n * @see https://vkcom.github.io/VKUI/#/PanelHeaderContext\n */\nexport const PanelHeaderContext = ({\n  children,\n  onClose,\n  opened = false,\n  className,\n  ...restProps\n}: PanelHeaderContextProps) => {\n  const { document } = useDOM();\n  const platform = usePlatform();\n  const [visible, setVisible] = React.useState(opened);\n  const closing = visible && !opened;\n  const { sizeX = 'none' } = useAdaptivity();\n  const elementRef = React.useRef<HTMLDivElement>(null);\n\n  useIsomorphicLayoutEffect(() => {\n    opened && setVisible(true);\n  }, [opened]);\n\n  useScrollLock(platform !== 'vkcom' && opened);\n\n  // start closing on outer click\n  useGlobalEventListener(\n    document,\n    'click',\n    opened &&\n      !closing &&\n      ((event) => {\n        if (elementRef.current && !elementRef.current.contains(event.target as Node)) {\n          event.stopPropagation();\n          onClose();\n        }\n      }),\n    { capture: true },\n  );\n\n  // fallback onAnimationEnd when animationend not supported\n  const onAnimationEnd = () => setVisible(false);\n  const animationFallback = useTimeout(onAnimationEnd, 200);\n  React.useEffect(\n    () => (closing ? animationFallback.set() : animationFallback.clear()),\n    [animationFallback, closing],\n  );\n\n  return (\n    <FixedLayout\n      {...restProps}\n      className={classNames(\n        styles['PanelHeaderContext'],\n        platform === 'ios' && styles['PanelHeaderContext--ios'],\n        opened && styles['PanelHeaderContext--opened'],\n        closing && styles['PanelHeaderContext--closing'],\n        sizeXClassNames[sizeX],\n        className,\n      )}\n      vertical=\"top\"\n    >\n      {visible && (\n        <div\n          onClick={(event) => {\n            event.stopPropagation();\n            onClose();\n          }}\n          className={styles['PanelHeaderContext__fade']}\n        />\n      )}\n      <div\n        className={styles['PanelHeaderContext__in']}\n        ref={elementRef}\n        onAnimationEnd={closing ? onAnimationEnd : undefined}\n      >\n        {visible && <div className={styles['PanelHeaderContext__content']}>{children}</div>}\n      </div>\n    </FixedLayout>\n  );\n};\n"],"names":["React","classNames","useAdaptivity","useGlobalEventListener","usePlatform","useTimeout","useDOM","useIsomorphicLayoutEffect","useScrollLock","FixedLayout","styles","sizeXClassNames","none","PanelHeaderContext","children","onClose","opened","className","restProps","document","platform","visible","setVisible","useState","closing","sizeX","elementRef","useRef","event","current","contains","target","stopPropagation","capture","onAnimationEnd","animationFallback","useEffect","set","clear","vertical","div","onClick","ref","undefined"],"mappings":"AAAA,YAAYA,WAAW,QAAQ;AAC/B,SAASC,UAAU,QAAQ,kBAAkB;AAC7C,SAASC,aAAa,QAAQ,4BAA4B;AAC1D,SAASC,sBAAsB,QAAQ,qCAAqC;AAC5E,SAASC,WAAW,QAAQ,0BAA0B;AACtD,SAASC,UAAU,QAAQ,yBAAyB;AACpD,SAASC,MAAM,QAAQ,gBAAgB;AACvC,SAASC,yBAAyB,QAAQ,sCAAsC;AAEhF,SAASC,aAAa,QAAQ,2BAA2B;AACzD,SAASC,WAAW,QAAQ,6BAA6B;AACzD,OAAOC,YAAY,kCAAkC;AAErD,MAAMC,kBAAkB;IACtBC,MAAMF,MAAM,CAAC,iCAAiC;IAC9C,CAAC,UAAU,EAAEA,MAAM,CAAC,oCAAoC;IACxD,CAAC,UAAU,EAAEA,MAAM,CAAC,oCAAoC;AAC1D;AAOA;;CAEC,GACD,OAAO,MAAMG,qBAAqB,CAAC,EACjCC,QAAQ,EACRC,OAAO,EACPC,SAAS,KAAK,EACdC,SAAS,EACT,GAAGC,WACqB;IACxB,MAAM,EAAEC,QAAQ,EAAE,GAAGb;IACrB,MAAMc,WAAWhB;IACjB,MAAM,CAACiB,SAASC,WAAW,GAAGtB,MAAMuB,QAAQ,CAACP;IAC7C,MAAMQ,UAAUH,WAAW,CAACL;IAC5B,MAAM,EAAES,QAAQ,MAAM,EAAE,GAAGvB;IAC3B,MAAMwB,aAAa1B,MAAM2B,MAAM,CAAiB;IAEhDpB,0BAA0B;QACxBS,UAAUM,WAAW;IACvB,GAAG;QAACN;KAAO;IAEXR,cAAcY,aAAa,WAAWJ;IAEtC,+BAA+B;IAC/Bb,uBACEgB,UACA,SACAH,UACE,CAACQ,WACA,CAAA,CAACI;QACA,IAAIF,WAAWG,OAAO,IAAI,CAACH,WAAWG,OAAO,CAACC,QAAQ,CAACF,MAAMG,MAAM,GAAW;YAC5EH,MAAMI,eAAe;YACrBjB;QACF;IACF,CAAA,GACF;QAAEkB,SAAS;IAAK;IAGlB,0DAA0D;IAC1D,MAAMC,iBAAiB,IAAMZ,WAAW;IACxC,MAAMa,oBAAoB9B,WAAW6B,gBAAgB;IACrDlC,MAAMoC,SAAS,CACb,IAAOZ,UAAUW,kBAAkBE,GAAG,KAAKF,kBAAkBG,KAAK,IAClE;QAACH;QAAmBX;KAAQ;IAG9B,qBACE,oBAACf;QACE,GAAGS,SAAS;QACbD,WAAWhB,WACTS,MAAM,CAAC,qBAAqB,EAC5BU,aAAa,SAASV,MAAM,CAAC,0BAA0B,EACvDM,UAAUN,MAAM,CAAC,6BAA6B,EAC9Cc,WAAWd,MAAM,CAAC,8BAA8B,EAChDC,eAAe,CAACc,MAAM,EACtBR;QAEFsB,UAAS;OAERlB,yBACC,oBAACmB;QACCC,SAAS,CAACb;YACRA,MAAMI,eAAe;YACrBjB;QACF;QACAE,WAAWP,MAAM,CAAC,2BAA2B;sBAGjD,oBAAC8B;QACCvB,WAAWP,MAAM,CAAC,yBAAyB;QAC3CgC,KAAKhB;QACLQ,gBAAgBV,UAAUU,iBAAiBS;OAE1CtB,yBAAW,oBAACmB;QAAIvB,WAAWP,MAAM,CAAC,8BAA8B;OAAGI;AAI5E,EAAE"}