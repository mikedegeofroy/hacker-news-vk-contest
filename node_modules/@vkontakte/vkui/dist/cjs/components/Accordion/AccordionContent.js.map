{"version":3,"sources":["../../../../src/components/Accordion/AccordionContent.tsx"],"sourcesContent":["import * as React from 'react';\nimport { classNames } from '@vkontakte/vkjs';\nimport { useExternRef } from '../../hooks/useExternRef';\nimport { useGlobalEventListener } from '../../hooks/useGlobalEventListener';\nimport { useDOM } from '../../lib/dom';\nimport { useIsomorphicLayoutEffect } from '../../lib/useIsomorphicLayoutEffect';\nimport { HasRef, HasRootRef } from '../../types';\nimport { AccordionContext } from './AccordionContext';\nimport styles from './Accordion.module.css';\n\n/**\n * Функция расчета max-height, для скрытия или раскрытия контента.\n */\nfunction calcMaxHeight(expanded: boolean, el: HTMLElement | null): string {\n  if (!expanded) {\n    return '0px';\n  }\n\n  // В первый рендеринг нельзя узнать высоту элемента\n  if (el === null) {\n    return 'inherit';\n  }\n\n  return `${el.scrollHeight}px`;\n}\n\n/**\n * Хук для отслеживания изменения высоты контента.\n */\nfunction useResizeContent(expanded: boolean, inRef: React.MutableRefObject<HTMLDivElement | null>) {\n  const resize = () => {\n    inRef.current!.style.maxHeight = calcMaxHeight(expanded, inRef.current);\n  };\n\n  const { window } = useDOM();\n  useGlobalEventListener(window, 'resize', resize);\n  useIsomorphicLayoutEffect(resize, []);\n}\n\n/**\n * Хук для скрывания или раскрывания контента. Возвращает стили для in элемента.\n */\nfunction useAccordionContent(\n  expanded: boolean,\n  inRef: React.MutableRefObject<HTMLDivElement | null>,\n) {\n  const maxHeight = calcMaxHeight(expanded, inRef.current);\n\n  useResizeContent(expanded, inRef);\n\n  return { maxHeight };\n}\n\nexport interface AccordionContentProps\n  extends HasRootRef<HTMLDivElement>,\n    HasRef<HTMLDivElement>,\n    React.HTMLAttributes<HTMLDivElement> {}\n\nexport const AccordionContent = ({\n  getRootRef,\n  getRef,\n  className,\n  children,\n  ...restProps\n}: AccordionContentProps) => {\n  const inRef = useExternRef(getRef);\n  const { expanded, labelId, contentId } = React.useContext(AccordionContext);\n\n  const inStyle = useAccordionContent(expanded, inRef);\n\n  return (\n    <div\n      ref={getRootRef}\n      id={contentId}\n      role=\"region\"\n      aria-labelledby={labelId}\n      aria-hidden={!expanded}\n      className={classNames(styles['AccordionContent'], className)}\n      {...restProps}\n    >\n      <div ref={inRef} className={styles['AccordionContent__in']} style={inStyle}>\n        {children}\n      </div>\n    </div>\n  );\n};\n"],"names":["AccordionContent","calcMaxHeight","expanded","el","scrollHeight","useResizeContent","inRef","resize","current","style","maxHeight","window","useDOM","useGlobalEventListener","useIsomorphicLayoutEffect","useAccordionContent","getRootRef","getRef","className","children","restProps","useExternRef","labelId","contentId","React","useContext","AccordionContext","inStyle","div","ref","id","role","aria-labelledby","aria-hidden","classNames"],"mappings":";;;;+BA0DaA;;;eAAAA;;;;;;iEA1DU;sBACI;8BACE;wCACU;qBAChB;2CACmB;kCAET;AAGjC;;CAEC,GACD,SAASC,cAAcC,QAAiB,EAAEC,EAAsB;IAC9D,IAAI,CAACD,UAAU;QACb,OAAO;IACT;IAEA,mDAAmD;IACnD,IAAIC,OAAO,MAAM;QACf,OAAO;IACT;IAEA,OAAO,CAAC,EAAEA,GAAGC,YAAY,CAAC,EAAE,CAAC;AAC/B;AAEA;;CAEC,GACD,SAASC,iBAAiBH,QAAiB,EAAEI,KAAoD;IAC/F,MAAMC,SAAS;QACbD,MAAME,OAAO,CAAEC,KAAK,CAACC,SAAS,GAAGT,cAAcC,UAAUI,MAAME,OAAO;IACxE;IAEA,MAAM,EAAEG,MAAM,EAAE,GAAGC,IAAAA,WAAM;IACzBC,IAAAA,8CAAsB,EAACF,QAAQ,UAAUJ;IACzCO,IAAAA,oDAAyB,EAACP,QAAQ,EAAE;AACtC;AAEA;;CAEC,GACD,SAASQ,oBACPb,QAAiB,EACjBI,KAAoD;IAEpD,MAAMI,YAAYT,cAAcC,UAAUI,MAAME,OAAO;IAEvDH,iBAAiBH,UAAUI;IAE3B,OAAO;QAAEI;IAAU;AACrB;AAOO,MAAMV,mBAAmB;QAAC,EAC/BgB,UAAU,EACVC,MAAM,EACNC,SAAS,EACTC,QAAQ,EAEc,WADnBC;QAJHJ;QACAC;QACAC;QACAC;;IAGA,MAAMb,QAAQe,IAAAA,0BAAY,EAACJ;IAC3B,MAAM,EAAEf,QAAQ,EAAEoB,OAAO,EAAEC,SAAS,EAAE,GAAGC,OAAMC,UAAU,CAACC,kCAAgB;IAE1E,MAAMC,UAAUZ,oBAAoBb,UAAUI;IAE9C,qBACE,qBAACsB;QACCC,KAAKb;QACLc,IAAIP;QACJQ,MAAK;QACLC,mBAAiBV;QACjBW,eAAa,CAAC/B;QACdgB,WAAWgB,IAAAA,gBAAU,0BAA6BhB;OAC9CE,0BAEJ,qBAACQ;QAAIC,KAAKvB;QAAOY,SAAS;QAAkCT,OAAOkB;OAChER;AAIT"}