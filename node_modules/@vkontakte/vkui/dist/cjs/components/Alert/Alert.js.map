{"version":3,"sources":["../../../../src/components/Alert/Alert.tsx"],"sourcesContent":["import * as React from 'react';\nimport { Icon20Cancel } from '@vkontakte/icons';\nimport { classNames, hasReactNode } from '@vkontakte/vkjs';\nimport { useAdaptivityWithJSMediaQueries } from '../../hooks/useAdaptivityWithJSMediaQueries';\nimport { usePlatform } from '../../hooks/usePlatform';\nimport { useWaitTransitionFinish } from '../../hooks/useWaitTransitionFinish';\nimport { stopPropagation } from '../../lib/utils';\nimport { AlignType, AnchorHTMLAttributesOnly, HasDataAttribute, HasRootRef } from '../../types';\nimport { useScrollLock } from '../AppRoot/ScrollContext';\nimport { ButtonProps } from '../Button/Button';\nimport { FocusTrap } from '../FocusTrap/FocusTrap';\nimport { IconButton } from '../IconButton/IconButton';\nimport { ModalDismissButton } from '../ModalDismissButton/ModalDismissButton';\nimport { PopoutWrapper } from '../PopoutWrapper/PopoutWrapper';\nimport { AlertActionProps } from './AlertAction';\nimport { AlertActions } from './AlertActions';\nimport { AlertHeader, AlertText } from './AlertTypography';\nimport styles from './Alert.module.css';\n\ntype AlertActionMode = 'cancel' | 'destructive' | 'default';\n\nexport interface AlertActionInterface\n  extends Pick<ButtonProps, 'Component'>,\n    AnchorHTMLAttributesOnly,\n    HasDataAttribute {\n  title: string;\n  action?: VoidFunction;\n  /**\n   * По умолчанию клик на опцию вызывает переданную в `Alert` функцию `onClose`, данное свойство\n   * позволяет отключить такое поведение\n   */\n  autoCloseDisabled?: boolean;\n  mode: AlertActionMode;\n}\n\nexport interface AlertProps extends React.HTMLAttributes<HTMLElement>, HasRootRef<HTMLDivElement> {\n  actionsLayout?: 'vertical' | 'horizontal';\n  actionsAlign?: AlignType;\n  actions?: AlertActionInterface[];\n  renderAction?: (props: AlertActionProps) => React.ReactNode;\n  header?: React.ReactNode;\n  text?: React.ReactNode;\n  onClose: VoidFunction;\n  /**\n   * Текст кнопки закрытия. Делает ее доступной для ассистивных технологий\n   */\n  dismissLabel?: string;\n  /**\n   * Расположение кнопки закрытия (внутри и вне `popout'a`)\n   * Доступно только в `compact`-режиме, не отображается на `iOS`\n   */\n  dismissButtonMode?: 'inside' | 'outside';\n  /**\n   * `data-testid` для кнопки закрытия\n   */\n  dismissButtonTestId?: string;\n}\n\n/**\n * @see https://vkcom.github.io/VKUI/#/Alert\n */\nexport const Alert = ({\n  actions = [],\n  actionsLayout = 'horizontal',\n  children,\n  className,\n  style,\n  text,\n  header,\n  onClose,\n  dismissLabel = 'Закрыть предупреждение',\n  renderAction,\n  actionsAlign,\n  dismissButtonMode = 'outside',\n  dismissButtonTestId,\n  getRootRef,\n  ...restProps\n}: AlertProps) => {\n  const generatedId = React.useId();\n\n  const headerId = `vkui-alert-${generatedId}-header`;\n  const textId = `vkui-alert-${generatedId}-text`;\n\n  const platform = usePlatform();\n  const { isDesktop } = useAdaptivityWithJSMediaQueries();\n  const { waitTransitionFinish } = useWaitTransitionFinish();\n\n  const [closing, setClosing] = React.useState(false);\n  const isDismissButtonVisible = isDesktop && platform !== 'ios';\n\n  const elementRef = React.useRef<HTMLDivElement>(null);\n\n  const timeout = platform === 'ios' ? 300 : 200;\n\n  const close = React.useCallback(() => {\n    setClosing(true);\n    waitTransitionFinish(\n      elementRef.current,\n      (e?: TransitionEvent) => {\n        if (!e || e.propertyName === 'opacity') {\n          onClose();\n        }\n      },\n      timeout,\n    );\n  }, [elementRef, waitTransitionFinish, onClose, timeout]);\n\n  const onItemClick = React.useCallback(\n    (item: AlertActionInterface) => {\n      const { action, autoCloseDisabled = false } = item;\n\n      if (!autoCloseDisabled) {\n        setClosing(true);\n        waitTransitionFinish(\n          elementRef.current,\n          (e?: TransitionEvent) => {\n            if (!e || e.propertyName === 'opacity') {\n              onClose();\n              action && action();\n            }\n          },\n          timeout,\n        );\n      } else {\n        action && action();\n      }\n    },\n    [elementRef, waitTransitionFinish, onClose, timeout],\n  );\n\n  useScrollLock();\n\n  return (\n    <PopoutWrapper\n      className={className}\n      closing={closing}\n      style={style}\n      onClick={close}\n      getRootRef={getRootRef}\n    >\n      <FocusTrap\n        {...restProps}\n        getRootRef={elementRef}\n        onClick={stopPropagation}\n        onClose={close}\n        timeout={timeout}\n        className={classNames(\n          styles['Alert'],\n          platform === 'ios' && styles['Alert--ios'],\n          platform === 'vkcom' && styles['Alert--vkcom'],\n          closing && styles['Alert--closing'],\n          isDesktop && styles['Alert--desktop'],\n        )}\n        role=\"alertdialog\"\n        aria-modal\n        aria-labelledby={headerId}\n        aria-describedby={textId}\n      >\n        <div\n          className={classNames(\n            styles['Alert__content'],\n            dismissButtonMode === 'inside' && styles['Alert__content--withButton'],\n          )}\n        >\n          {hasReactNode(header) && <AlertHeader id={headerId}>{header}</AlertHeader>}\n          {hasReactNode(text) && <AlertText id={textId}>{text}</AlertText>}\n          {children}\n          {isDismissButtonVisible && dismissButtonMode === 'inside' && (\n            <IconButton\n              label={dismissLabel}\n              className={classNames(styles['Alert__dismiss'], 'vkuiInternalAlert__dismiss')}\n              onClick={close}\n              hoverMode=\"opacity\"\n              activeMode=\"opacity\"\n              data-testid={dismissButtonTestId}\n            >\n              <Icon20Cancel />\n            </IconButton>\n          )}\n        </div>\n        <AlertActions\n          actions={actions}\n          actionsAlign={actionsAlign}\n          actionsLayout={actionsLayout}\n          renderAction={renderAction}\n          onItemClick={onItemClick}\n        />\n        {isDismissButtonVisible && dismissButtonMode === 'outside' && (\n          <ModalDismissButton onClick={close} data-testid={dismissButtonTestId}>\n            {dismissLabel}\n          </ModalDismissButton>\n        )}\n      </FocusTrap>\n    </PopoutWrapper>\n  );\n};\n"],"names":["Alert","actions","actionsLayout","children","className","style","text","header","onClose","dismissLabel","renderAction","actionsAlign","dismissButtonMode","dismissButtonTestId","getRootRef","restProps","generatedId","React","useId","headerId","textId","platform","usePlatform","isDesktop","useAdaptivityWithJSMediaQueries","waitTransitionFinish","useWaitTransitionFinish","closing","setClosing","useState","isDismissButtonVisible","elementRef","useRef","timeout","close","useCallback","current","e","propertyName","onItemClick","item","action","autoCloseDisabled","useScrollLock","PopoutWrapper","onClick","FocusTrap","stopPropagation","classNames","role","aria-modal","aria-labelledby","aria-describedby","div","hasReactNode","AlertHeader","id","AlertText","IconButton","label","hoverMode","activeMode","data-testid","Icon20Cancel","AlertActions","ModalDismissButton"],"mappings":"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"}