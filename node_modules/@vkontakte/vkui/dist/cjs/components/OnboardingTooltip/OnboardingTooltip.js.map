{"version":3,"sources":["../../../../src/components/OnboardingTooltip/OnboardingTooltip.tsx"],"sourcesContent":["import * as React from 'react';\nimport { hasReactNode } from '@vkontakte/vkjs';\nimport { useExternRef } from '../../hooks/useExternRef';\nimport { usePatchChildren } from '../../hooks/usePatchChildren';\nimport { createPortal } from '../../lib/createPortal';\nimport {\n  autoUpdateFloatingElement,\n  convertFloatingDataToReactCSSProperties,\n  type FloatingComponentProps,\n  useFloating,\n  useFloatingMiddlewaresBootstrap,\n  usePlacementChangeCallback,\n} from '../../lib/floating';\nimport { useIsomorphicLayoutEffect } from '../../lib/useIsomorphicLayoutEffect';\nimport { warnOnce } from '../../lib/warnOnce';\nimport { DEFAULT_ARROW_HEIGHT, DEFAULT_ARROW_PADDING } from '../FloatingArrow/DefaultIcon';\nimport { FloatingArrowProps } from '../FloatingArrow/FloatingArrow';\nimport { useNavTransition } from '../NavTransitionContext/NavTransitionContext';\nimport { TOOLTIP_MAX_WIDTH, TooltipBase, type TooltipBaseProps } from '../TooltipBase/TooltipBase';\nimport { onboardingTooltipContainerAttr } from './OnboardingTooltipContainer';\nimport styles from './OnboardingTooltip.module.css';\n\nconst warn = warnOnce('OnboardingTooltip');\n\ntype AllowedFloatingComponentProps = Pick<\n  FloatingComponentProps,\n  | 'arrowHeight'\n  | 'arrowPadding'\n  | 'arrowRef'\n  | 'placement'\n  | 'offsetByMainAxis'\n  | 'offsetByCrossAxis'\n  | 'shown'\n  | 'children'\n  | 'onPlacementChange'\n>;\n\ntype AllowedTooltipBaseProps = Omit<TooltipBaseProps, 'arrowProps'>;\n\ntype AllowedFloatingArrowProps = {\n  /**\n   * Сдвиг стрелки относительно текущих координат.\n   */\n  arrowOffset?: FloatingArrowProps['offset'];\n  /**\n   * Включает абсолютное смещение по `arrowOffset`.\n   */\n  isStaticArrowOffset?: FloatingArrowProps['isStaticOffset'];\n};\n\nexport interface OnboardingTooltipProps\n  extends AllowedFloatingComponentProps,\n    AllowedTooltipBaseProps,\n    AllowedFloatingArrowProps {\n  /**\n   * Скрывает стрелку, указывающую на якорный элемент.\n   */\n  disableArrow?: boolean;\n  /**\n   * Callback, который вызывается при клике по любому месту в пределах экрана.\n   */\n  onClose?(this: void): void;\n}\n\n/**\n * @see https://vkcom.github.io/VKUI/#/Tooltip\n */\nexport const OnboardingTooltip = ({\n  id: idProp,\n  children,\n  shown: shownProp = true,\n  arrowPadding = DEFAULT_ARROW_PADDING,\n  arrowHeight = DEFAULT_ARROW_HEIGHT,\n  offsetByMainAxis = 0,\n  offsetByCrossAxis = 0,\n  arrowOffset = 0,\n  isStaticArrowOffset = false,\n  onClose,\n  placement: placementProp = 'bottom-start',\n  maxWidth = TOOLTIP_MAX_WIDTH,\n  style: styleProp,\n  getRootRef,\n  disableArrow = false,\n  onPlacementChange,\n  ...restProps\n}: OnboardingTooltipProps) => {\n  const generatedId = React.useId();\n  const tooltipId = idProp || generatedId;\n  const { entering } = useNavTransition();\n\n  const [arrowRef, setArrowRef] = React.useState<HTMLDivElement | null>(null);\n  const [tooltipContainer, setTooltipContainer] = React.useState<HTMLElement | null>(null);\n  const [positionStrategy, setPositionStrategy] = React.useState<'fixed' | 'absolute'>('absolute');\n  const shown = shownProp && tooltipContainer && !entering;\n\n  const { middlewares, strictPlacement } = useFloatingMiddlewaresBootstrap({\n    placement: placementProp,\n    offsetByMainAxis,\n    offsetByCrossAxis,\n    arrowRef,\n    arrow: !disableArrow,\n    arrowHeight,\n    arrowPadding,\n  });\n  const {\n    x: floatingDataX,\n    y: floatingDataY,\n    refs,\n    placement: resolvedPlacement,\n    middlewareData: { arrow: arrowCoords },\n  } = useFloating({\n    strategy: positionStrategy,\n    placement: strictPlacement,\n    middleware: middlewares,\n    whileElementsMounted: autoUpdateFloatingElement,\n  });\n  const tooltipRef = useExternRef<HTMLDivElement>(getRootRef, refs.setFloating);\n  const [childRef, child] = usePatchChildren(children, {\n    'aria-describedby': shown ? tooltipId : undefined,\n  });\n\n  usePlacementChangeCallback(resolvedPlacement, onPlacementChange);\n\n  let tooltip: React.ReactPortal | null = null;\n  if (shown) {\n    const floatingStyle = convertFloatingDataToReactCSSProperties(\n      positionStrategy,\n      floatingDataX,\n      floatingDataY,\n    );\n\n    if (styleProp) {\n      Object.assign(floatingStyle, styleProp);\n    }\n\n    tooltip = createPortal(\n      <>\n        <TooltipBase\n          {...restProps}\n          id={tooltipId}\n          getRootRef={tooltipRef}\n          style={floatingStyle}\n          maxWidth={maxWidth}\n          arrowProps={\n            disableArrow\n              ? undefined\n              : {\n                  offset: arrowOffset,\n                  isStaticOffset: isStaticArrowOffset,\n                  coords: arrowCoords,\n                  placement: resolvedPlacement,\n                  getRootRef: setArrowRef,\n                }\n          }\n        />\n        <div className={styles['OnboardingTooltip__overlay']} onClickCapture={onClose} />\n      </>,\n      tooltipContainer,\n    );\n  }\n\n  useIsomorphicLayoutEffect(\n    function initialize() {\n      const referenceEl = childRef.current;\n      if (referenceEl) {\n        setTooltipContainer(\n          referenceEl.closest<HTMLDivElement>(`[${onboardingTooltipContainerAttr}]`), // eslint-disable-line no-restricted-properties\n        );\n        setPositionStrategy(referenceEl.style.position === 'fixed' ? 'fixed' : 'absolute');\n        refs.setReference(referenceEl);\n      }\n    },\n    [childRef],\n  );\n\n  if (process.env.NODE_ENV === 'development') {\n    const multiChildren = React.Children.count(children) > 1;\n    // Empty children is a noop\n    const primitiveChild = hasReactNode(children) && typeof children !== 'object';\n    (multiChildren || primitiveChild) &&\n      warn(\n        [\n          'children должен быть одним React элементом, получено',\n          multiChildren && 'несколько',\n          primitiveChild && JSON.stringify(children),\n        ]\n          .filter(Boolean)\n          .join(' '),\n        'error',\n      );\n\n    if (refs.reference.current && !tooltipContainer) {\n      throw new Error('Use TooltipContainer for Tooltip outside Panel (see docs)');\n    }\n  }\n\n  return (\n    <React.Fragment>\n      {child}\n      {tooltip}\n    </React.Fragment>\n  );\n};\n"],"names":["OnboardingTooltip","warn","warnOnce","id","idProp","children","shown","shownProp","arrowPadding","DEFAULT_ARROW_PADDING","arrowHeight","DEFAULT_ARROW_HEIGHT","offsetByMainAxis","offsetByCrossAxis","arrowOffset","isStaticArrowOffset","onClose","placement","placementProp","maxWidth","TOOLTIP_MAX_WIDTH","style","styleProp","getRootRef","disableArrow","onPlacementChange","restProps","generatedId","React","useId","tooltipId","entering","useNavTransition","arrowRef","setArrowRef","useState","tooltipContainer","setTooltipContainer","positionStrategy","setPositionStrategy","middlewares","strictPlacement","useFloatingMiddlewaresBootstrap","arrow","x","floatingDataX","y","floatingDataY","refs","resolvedPlacement","middlewareData","arrowCoords","useFloating","strategy","middleware","whileElementsMounted","autoUpdateFloatingElement","tooltipRef","useExternRef","setFloating","childRef","child","usePatchChildren","undefined","usePlacementChangeCallback","tooltip","floatingStyle","convertFloatingDataToReactCSSProperties","Object","assign","createPortal","TooltipBase","arrowProps","offset","isStaticOffset","coords","div","className","onClickCapture","useIsomorphicLayoutEffect","initialize","referenceEl","current","closest","onboardingTooltipContainerAttr","position","setReference","process","env","NODE_ENV","multiChildren","Children","count","primitiveChild","hasReactNode","JSON","stringify","filter","Boolean","join","reference","Error","Fragment"],"mappings":";;;;+BAmEaA;;;eAAAA;;;;;;;iEAnEU;sBACM;8BACA;kCACI;8BACJ;0BAQtB;2CACmC;0BACjB;6BACmC;sCAE3B;6BACqC;4CACvB;AAG/C,MAAMC,OAAOC,IAAAA,kBAAQ,EAAC;AA6Cf,MAAMF,oBAAoB;QAAC,EAChCG,IAAIC,MAAM,EACVC,QAAQ,EACRC,OAAOC,YAAY,IAAI,EACvBC,eAAeC,kCAAqB,EACpCC,cAAcC,iCAAoB,EAClCC,mBAAmB,CAAC,EACpBC,oBAAoB,CAAC,EACrBC,cAAc,CAAC,EACfC,sBAAsB,KAAK,EAC3BC,OAAO,EACPC,WAAWC,gBAAgB,cAAc,EACzCC,WAAWC,8BAAiB,EAC5BC,OAAOC,SAAS,EAChBC,UAAU,EACVC,eAAe,KAAK,EACpBC,iBAAiB,EAEM,WADpBC;QAhBHvB;QACAE;QACAC;QACAE;QACAE;QACAE;QACAC;QACAC;QACAC;QACAC;QACAC;QACAE;QACAE;QACAE;QACAC;QACAC;;IAGA,MAAME,cAAcC,OAAMC,KAAK;IAC/B,MAAMC,YAAY1B,UAAUuB;IAC5B,MAAM,EAAEI,QAAQ,EAAE,GAAGC,IAAAA,sCAAgB;IAErC,MAAM,CAACC,UAAUC,YAAY,GAAGN,OAAMO,QAAQ,CAAwB;IACtE,MAAM,CAACC,kBAAkBC,oBAAoB,GAAGT,OAAMO,QAAQ,CAAqB;IACnF,MAAM,CAACG,kBAAkBC,oBAAoB,GAAGX,OAAMO,QAAQ,CAAuB;IACrF,MAAM7B,QAAQC,aAAa6B,oBAAoB,CAACL;IAEhD,MAAM,EAAES,WAAW,EAAEC,eAAe,EAAE,GAAGC,IAAAA,yCAA+B,EAAC;QACvEzB,WAAWC;QACXN;QACAC;QACAoB;QACAU,OAAO,CAACnB;QACRd;QACAF;IACF;IACA,MAAM,EACJoC,GAAGC,aAAa,EAChBC,GAAGC,aAAa,EAChBC,IAAI,EACJ/B,WAAWgC,iBAAiB,EAC5BC,gBAAgB,EAAEP,OAAOQ,WAAW,EAAE,EACvC,GAAGC,IAAAA,qBAAW,EAAC;QACdC,UAAUf;QACVrB,WAAWwB;QACXa,YAAYd;QACZe,sBAAsBC,mCAAyB;IACjD;IACA,MAAMC,aAAaC,IAAAA,0BAAY,EAAiBnC,YAAYyB,KAAKW,WAAW;IAC5E,MAAM,CAACC,UAAUC,MAAM,GAAGC,IAAAA,kCAAgB,EAACzD,UAAU;QACnD,oBAAoBC,QAAQwB,YAAYiC;IAC1C;IAEAC,IAAAA,oCAA0B,EAACf,mBAAmBxB;IAE9C,IAAIwC,UAAoC;IACxC,IAAI3D,OAAO;QACT,MAAM4D,gBAAgBC,IAAAA,iDAAuC,EAC3D7B,kBACAO,eACAE;QAGF,IAAIzB,WAAW;YACb8C,OAAOC,MAAM,CAACH,eAAe5C;QAC/B;QAEA2C,UAAUK,IAAAA,0BAAY,gBACpB,0DACE,qBAACC,wBAAW,8CACN7C;YACJvB,IAAI2B;YACJP,YAAYkC;YACZpC,OAAO6C;YACP/C,UAAUA;YACVqD,YACEhD,eACIuC,YACA;gBACEU,QAAQ3D;gBACR4D,gBAAgB3D;gBAChB4D,QAAQxB;gBACRlC,WAAWgC;gBACX1B,YAAYW;YACd;2BAGR,qBAAC0C;YAAIC,SAAS;YAAwCC,gBAAgB9D;aAExEoB;IAEJ;IAEA2C,IAAAA,oDAAyB,EACvB,SAASC;QACP,MAAMC,cAAcrB,SAASsB,OAAO;QACpC,IAAID,aAAa;YACf5C,oBACE4C,YAAYE,OAAO,CAAiB,CAAC,CAAC,EAAEC,0DAA8B,CAAC,CAAC,CAAC;YAE3E7C,oBAAoB0C,YAAY5D,KAAK,CAACgE,QAAQ,KAAK,UAAU,UAAU;YACvErC,KAAKsC,YAAY,CAACL;QACpB;IACF,GACA;QAACrB;KAAS;IAGZ,IAAI2B,QAAQC,GAAG,CAACC,QAAQ,KAAK,eAAe;QAC1C,MAAMC,gBAAgB9D,OAAM+D,QAAQ,CAACC,KAAK,CAACvF,YAAY;QACvD,2BAA2B;QAC3B,MAAMwF,iBAAiBC,IAAAA,kBAAY,EAACzF,aAAa,OAAOA,aAAa;QACpEqF,CAAAA,iBAAiBG,cAAa,KAC7B5F,KACE;YACE;YACAyF,iBAAiB;YACjBG,kBAAkBE,KAAKC,SAAS,CAAC3F;SAClC,CACE4F,MAAM,CAACC,SACPC,IAAI,CAAC,MACR;QAGJ,IAAInD,KAAKoD,SAAS,CAAClB,OAAO,IAAI,CAAC9C,kBAAkB;YAC/C,MAAM,IAAIiE,MAAM;QAClB;IACF;IAEA,qBACE,qBAACzE,OAAM0E,QAAQ,QACZzC,OACAI;AAGP"}