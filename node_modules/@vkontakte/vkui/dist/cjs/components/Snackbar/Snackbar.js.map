{"version":3,"sources":["../../../../src/components/Snackbar/Snackbar.tsx"],"sourcesContent":["import * as React from 'react';\nimport { classNames } from '@vkontakte/vkjs';\nimport { useAdaptivityWithJSMediaQueries } from '../../hooks/useAdaptivityWithJSMediaQueries';\nimport { usePlatform } from '../../hooks/usePlatform';\nimport { useTimeout } from '../../hooks/useTimeout';\nimport { useWaitTransitionFinish } from '../../hooks/useWaitTransitionFinish';\nimport { ViewWidth } from '../../lib/adaptivity';\nimport { rubber } from '../../lib/touch';\nimport { HTMLAttributesWithRootRef } from '../../types';\nimport { AppRootPortal } from '../AppRoot/AppRootPortal';\nimport { Button } from '../Button/Button';\nimport { RootComponent } from '../RootComponent/RootComponent';\nimport { Touch, TouchEvent } from '../Touch/Touch';\nimport { Basic, BasicProps } from './subcomponents/Basic/Basic';\nimport styles from './Snackbar.module.css';\n\nexport interface SnackbarProps extends HTMLAttributesWithRootRef<HTMLElement>, BasicProps {\n  /**\n   * Название кнопки действия в уведомлении\n   * Не может использоваться одновременно с `subtitle`\n   */\n  action?: React.ReactNode;\n\n  /**\n   * Будет вызвано при клике на кнопку действия\n   */\n  onActionClick?: (e: React.MouseEvent) => void;\n\n  /**\n   * Время в миллисекундах, через которое плашка скроется\n   */\n  duration?: number;\n  /**\n   * Обработчик закрытия уведомления\n   */\n  onClose: () => void;\n  /**\n   * Величина отступа снизу. Используется для позиционирования элемента в случае, когда нежелательно, чтобы Snackbar при появлении перекрывал важные элементы интерфейса.\n   */\n  offsetY?: React.CSSProperties['bottom'];\n}\n\n/**\n * @see https://vkcom.github.io/VKUI/#/Snackbar\n */\nexport const Snackbar = ({\n  children,\n  layout: layoutProps,\n  action,\n  before,\n  after,\n  duration = 4000,\n  onActionClick,\n  onClose,\n  mode = 'default',\n  subtitle,\n  offsetY,\n  style,\n  ...restProps\n}: SnackbarProps) => {\n  const platform = usePlatform();\n  const { viewWidth } = useAdaptivityWithJSMediaQueries();\n  const isDesktop = viewWidth >= ViewWidth.SMALL_TABLET;\n  const { waitTransitionFinish } = useWaitTransitionFinish();\n\n  const [closing, setClosing] = React.useState(false);\n  const [touched, setTouched] = React.useState(false);\n\n  const shiftXPercentRef = React.useRef<number>(0);\n  const shiftXCurrentRef = React.useRef<number>(0);\n\n  const bodyElRef = React.useRef<HTMLDivElement | null>(null);\n  const innerElRef = React.useRef<HTMLDivElement | null>(null);\n\n  const animationFrameRef = React.useRef<ReturnType<typeof requestAnimationFrame> | null>(null);\n\n  const transitionFinishDurationFallback = platform === 'ios' ? 320 : 400;\n\n  const close = () => {\n    setClosing(true);\n    waitTransitionFinish(\n      innerElRef.current,\n      () => {\n        onClose();\n      },\n      transitionFinishDurationFallback,\n    );\n  };\n\n  const handleActionClick = (e: React.MouseEvent) => {\n    close();\n\n    if (action && typeof onActionClick === 'function') {\n      onActionClick(e);\n    }\n  };\n\n  const closeTimeout = useTimeout(close, duration);\n\n  const setBodyTransform = (percent: number) => {\n    if (animationFrameRef.current !== null) {\n      cancelAnimationFrame(animationFrameRef.current);\n    }\n    animationFrameRef.current = requestAnimationFrame(() => {\n      if (bodyElRef.current) {\n        bodyElRef.current.style.transform = `translate3d(${percent}%, 0, 0)`;\n      }\n    });\n  };\n\n  const onTouchStart = closeTimeout.clear;\n\n  const onTouchMoveX = (event: TouchEvent) => {\n    const { shiftX, originalEvent } = event;\n    originalEvent.preventDefault();\n\n    if (!touched) {\n      setTouched(true);\n    }\n\n    shiftXPercentRef.current = (shiftX / (bodyElRef.current?.offsetWidth ?? 0)) * 100;\n    shiftXCurrentRef.current = rubber(shiftXPercentRef.current, 72, 1.2, platform !== 'ios');\n\n    setBodyTransform(shiftXCurrentRef.current);\n  };\n\n  const onTouchEnd = (e: TouchEvent) => {\n    let callback: VoidFunction | undefined;\n\n    if (touched) {\n      let shiftXCurrent = shiftXCurrentRef.current;\n      const expectTranslateY = (shiftXCurrent / e.duration) * 240 * 0.6;\n      shiftXCurrent = shiftXCurrent + expectTranslateY;\n\n      if (isDesktop && shiftXCurrent <= -50) {\n        closeTimeout.clear();\n        waitTransitionFinish(\n          bodyElRef.current,\n          () => {\n            onClose();\n          },\n          transitionFinishDurationFallback,\n        );\n        setBodyTransform(-120);\n      } else if (!isDesktop && shiftXCurrent >= 50) {\n        closeTimeout.clear();\n        waitTransitionFinish(\n          bodyElRef.current,\n          () => {\n            onClose();\n          },\n          transitionFinishDurationFallback,\n        );\n        setBodyTransform(120);\n      } else {\n        callback = () => {\n          closeTimeout.set();\n          setBodyTransform(0);\n        };\n      }\n    } else {\n      closeTimeout.set();\n    }\n\n    setTouched(false);\n    callback && requestAnimationFrame(callback);\n  };\n\n  React.useEffect(() => closeTimeout.set(), [closeTimeout]);\n\n  const layout = layoutProps || (after || isDesktop || subtitle ? 'vertical' : 'horizontal');\n\n  return (\n    <AppRootPortal>\n      <RootComponent\n        {...restProps}\n        baseClassName={classNames(\n          styles['Snackbar'],\n          platform === 'ios' && styles['Snackbar--ios'],\n          closing && styles['Snackbar--closing'],\n          touched && styles['Snackbar--touched'],\n          isDesktop && styles['Snackbar--desktop'],\n        )}\n        style={offsetY ? { ...style, bottom: offsetY } : style}\n      >\n        <Touch\n          className={styles['Snackbar__in']}\n          getRootRef={innerElRef}\n          onStart={onTouchStart}\n          onMoveX={onTouchMoveX}\n          onEnd={onTouchEnd}\n        >\n          <Basic\n            className={styles['Snackbar__snackbar']}\n            getRootRef={bodyElRef}\n            layout={layout}\n            mode={mode}\n            before={before}\n            subtitle={subtitle}\n            action={\n              action && (\n                <Button\n                  align=\"left\"\n                  mode=\"link\"\n                  appearance={mode === 'dark' ? 'overlay' : 'accent'}\n                  size=\"s\"\n                  onClick={handleActionClick}\n                >\n                  {action}\n                </Button>\n              )\n            }\n            after={after}\n          >\n            {children}\n          </Basic>\n        </Touch>\n      </RootComponent>\n    </AppRootPortal>\n  );\n};\n\nSnackbar.Basic = Basic;\n"],"names":["Snackbar","children","layout","layoutProps","action","before","after","duration","onActionClick","onClose","mode","subtitle","offsetY","style","restProps","platform","usePlatform","viewWidth","useAdaptivityWithJSMediaQueries","isDesktop","ViewWidth","SMALL_TABLET","waitTransitionFinish","useWaitTransitionFinish","closing","setClosing","React","useState","touched","setTouched","shiftXPercentRef","useRef","shiftXCurrentRef","bodyElRef","innerElRef","animationFrameRef","transitionFinishDurationFallback","close","current","handleActionClick","e","closeTimeout","useTimeout","setBodyTransform","percent","cancelAnimationFrame","requestAnimationFrame","transform","onTouchStart","clear","onTouchMoveX","event","shiftX","originalEvent","preventDefault","offsetWidth","rubber","onTouchEnd","callback","shiftXCurrent","expectTranslateY","set","useEffect","AppRootPortal","RootComponent","baseClassName","classNames","bottom","Touch","className","getRootRef","onStart","onMoveX","onEnd","Basic","Button","align","appearance","size","onClick"],"mappings":"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"}