{"version":3,"sources":["../../../src/hooks/useKeyboardInputTracker.ts"],"sourcesContent":["import * as React from 'react';\nimport { isKeyboardFocusingStarted } from '../lib/accessibility';\nimport { useDOM } from '../lib/dom';\nimport { useIsomorphicLayoutEffect } from '../lib/useIsomorphicLayoutEffect';\n\nexport const ENABLE_KEYBOARD_INPUT_EVENT_NAME = 'enableKeyboardInput';\nexport const DISABLE_KEYBOARD_INPUT_EVENT_NAME = 'disableKeyboardInput';\n\nconst EVENT_OPTIONS = {\n  passive: true,\n  capture: true,\n};\n\n/**\n * Чтобы оптимизировать рендер, сохраняем в ref.\n *\n * В контекст можно передать через getter, подробнее в примере ниже.\n *\n * ```tsx\n * const keyboardInputTrackerRef = useKeyboardInputTracker();\n * <SomeContext.Provider value={{\n *  get keyboardInput() {\n *    return keyboardInputTrackerRef.current;\n *  }\n * }}>\n *  {children}\n * </SomeContext.Provider>\n * ```\n *\n * @private\n */\nexport function useKeyboardInputTracker(): React.MutableRefObject<boolean> {\n  const { document } = useDOM();\n  const keyboardFocusingStartedRef = React.useRef(false);\n\n  useIsomorphicLayoutEffect(() => {\n    /* istanbul ignore if: невозможный кейс, т.к. в SSR эффекты не вызываются. Проверка на будущее, если вдруг эффект будет вызываться. */\n    if (!document) {\n      return;\n    }\n\n    const handleKeydown = (event: KeyboardEvent) => {\n      if (isKeyboardFocusingStarted(event)) {\n        keyboardFocusingStartedRef.current = true;\n      }\n    };\n\n    const handleCustomEnableKeyboardEvent = () => {\n      keyboardFocusingStartedRef.current = true;\n    };\n\n    const handleCustomDisableKeyboardEvent = () => {\n      keyboardFocusingStartedRef.current = false;\n    };\n\n    document.addEventListener('keydown', handleKeydown, EVENT_OPTIONS);\n    document.addEventListener(ENABLE_KEYBOARD_INPUT_EVENT_NAME, handleCustomEnableKeyboardEvent, EVENT_OPTIONS); // prettier-ignore\n    document.addEventListener(DISABLE_KEYBOARD_INPUT_EVENT_NAME, handleCustomDisableKeyboardEvent, EVENT_OPTIONS); // prettier-ignore\n    document.addEventListener('mousedown', handleCustomDisableKeyboardEvent, EVENT_OPTIONS);\n    document.addEventListener('touchstart', handleCustomDisableKeyboardEvent, EVENT_OPTIONS);\n\n    return () => {\n      document.removeEventListener('keydown', handleKeydown, EVENT_OPTIONS);\n      document.removeEventListener(ENABLE_KEYBOARD_INPUT_EVENT_NAME, handleCustomEnableKeyboardEvent, EVENT_OPTIONS); // prettier-ignore\n      document.removeEventListener(DISABLE_KEYBOARD_INPUT_EVENT_NAME, handleCustomDisableKeyboardEvent, EVENT_OPTIONS); // prettier-ignore\n      document.removeEventListener('mousedown', handleCustomDisableKeyboardEvent, EVENT_OPTIONS);\n      document.removeEventListener('touchstart', handleCustomDisableKeyboardEvent, EVENT_OPTIONS);\n    };\n  }, [document]);\n\n  return keyboardFocusingStartedRef;\n}\n"],"names":["DISABLE_KEYBOARD_INPUT_EVENT_NAME","ENABLE_KEYBOARD_INPUT_EVENT_NAME","useKeyboardInputTracker","EVENT_OPTIONS","passive","capture","document","useDOM","keyboardFocusingStartedRef","React","useRef","useIsomorphicLayoutEffect","handleKeydown","event","isKeyboardFocusingStarted","current","handleCustomEnableKeyboardEvent","handleCustomDisableKeyboardEvent","addEventListener","removeEventListener"],"mappings":";;;;;;;;;;;IAMaA,iCAAiC;eAAjCA;;IADAC,gCAAgC;eAAhCA;;IA0BGC,uBAAuB;eAAvBA;;;;iEA/BO;+BACmB;qBACnB;2CACmB;AAEnC,MAAMD,mCAAmC;AACzC,MAAMD,oCAAoC;AAEjD,MAAMG,gBAAgB;IACpBC,SAAS;IACTC,SAAS;AACX;AAoBO,SAASH;IACd,MAAM,EAAEI,QAAQ,EAAE,GAAGC,IAAAA,WAAM;IAC3B,MAAMC,6BAA6BC,OAAMC,MAAM,CAAC;IAEhDC,IAAAA,oDAAyB,EAAC;QACxB,oIAAoI,GACpI,IAAI,CAACL,UAAU;YACb;QACF;QAEA,MAAMM,gBAAgB,CAACC;YACrB,IAAIC,IAAAA,wCAAyB,EAACD,QAAQ;gBACpCL,2BAA2BO,OAAO,GAAG;YACvC;QACF;QAEA,MAAMC,kCAAkC;YACtCR,2BAA2BO,OAAO,GAAG;QACvC;QAEA,MAAME,mCAAmC;YACvCT,2BAA2BO,OAAO,GAAG;QACvC;QAEAT,SAASY,gBAAgB,CAAC,WAAWN,eAAeT;QACpDG,SAASY,gBAAgB,CAACjB,kCAAkCe,iCAAiCb,gBAAgB,kBAAkB;QAC/HG,SAASY,gBAAgB,CAAClB,mCAAmCiB,kCAAkCd,gBAAgB,kBAAkB;QACjIG,SAASY,gBAAgB,CAAC,aAAaD,kCAAkCd;QACzEG,SAASY,gBAAgB,CAAC,cAAcD,kCAAkCd;QAE1E,OAAO;YACLG,SAASa,mBAAmB,CAAC,WAAWP,eAAeT;YACvDG,SAASa,mBAAmB,CAAClB,kCAAkCe,iCAAiCb,gBAAgB,kBAAkB;YAClIG,SAASa,mBAAmB,CAACnB,mCAAmCiB,kCAAkCd,gBAAgB,kBAAkB;YACpIG,SAASa,mBAAmB,CAAC,aAAaF,kCAAkCd;YAC5EG,SAASa,mBAAmB,CAAC,cAAcF,kCAAkCd;QAC/E;IACF,GAAG;QAACG;KAAS;IAEb,OAAOE;AACT"}