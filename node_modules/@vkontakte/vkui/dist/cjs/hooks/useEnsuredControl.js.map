{"version":3,"sources":["../../../src/hooks/useEnsuredControl.ts"],"sourcesContent":["import * as React from 'react';\nimport { isFunction } from '@vkontakte/vkjs';\nimport { useIsomorphicLayoutEffect } from '../lib/useIsomorphicLayoutEffect';\n\nexport interface UseEnsuredControlProps<V, E extends React.ChangeEvent<any>> {\n  value?: V;\n  defaultValue: V;\n  disabled?: boolean | undefined;\n  onChange?(this: void, e: E): any;\n}\n\nexport function useEnsuredControl<V, E extends React.ChangeEvent<any>>({\n  onChange: onChangeProp,\n  disabled,\n  ...props\n}: UseEnsuredControlProps<V, E>): [V, (e: E) => any] {\n  const [value, onChangeValue] = useCustomEnsuredControl(props);\n\n  const onChange = React.useCallback(\n    (e: E) => {\n      if (disabled) {\n        return;\n      }\n\n      onChangeValue(e.target.value);\n      onChangeProp && onChangeProp(e);\n    },\n    [onChangeValue, onChangeProp, disabled],\n  );\n\n  return [value, onChange];\n}\n\nexport interface UseCustomEnsuredControlProps<V> {\n  value?: V;\n  defaultValue: V;\n  disabled?: boolean | undefined;\n  onChange?(this: void, v: V): any;\n}\n\nexport function useCustomEnsuredControl<V = any>({\n  value,\n  defaultValue,\n  disabled,\n  onChange: onChangeProp,\n}: UseCustomEnsuredControlProps<V>): [V, React.Dispatch<React.SetStateAction<V>>] {\n  const isControlled = value !== undefined;\n  const [localValue, setLocalValue] = React.useState(defaultValue);\n  const preservedControlledValueRef = React.useRef<V>();\n\n  useIsomorphicLayoutEffect(() => {\n    preservedControlledValueRef.current = value;\n  });\n\n  const onChange = React.useCallback(\n    (nextValue: V | ((prevValue: any) => V)) => {\n      if (disabled) {\n        return;\n      }\n\n      if (isFunction(nextValue)) {\n        if (!isControlled) {\n          setLocalValue((prevValue) => {\n            const resolvedValue = nextValue(prevValue);\n            if (onChangeProp) {\n              onChangeProp(resolvedValue);\n            }\n            return resolvedValue;\n          });\n        } else if (onChangeProp) {\n          const resolvedValue = nextValue(preservedControlledValueRef.current);\n          onChangeProp(resolvedValue);\n        }\n      } else {\n        if (onChangeProp) {\n          onChangeProp(nextValue);\n        }\n        if (!isControlled) {\n          setLocalValue(nextValue);\n        }\n      }\n    },\n    [disabled, isControlled, onChangeProp],\n  );\n\n  return [isControlled ? value : localValue, onChange];\n}\n"],"names":["useCustomEnsuredControl","useEnsuredControl","onChange","onChangeProp","disabled","props","value","onChangeValue","React","useCallback","e","target","defaultValue","isControlled","undefined","localValue","setLocalValue","useState","preservedControlledValueRef","useRef","useIsomorphicLayoutEffect","current","nextValue","isFunction","prevValue","resolvedValue"],"mappings":";;;;;;;;;;;IAwCgBA,uBAAuB;eAAvBA;;IA7BAC,iBAAiB;eAAjBA;;;;;iEAXO;sBACI;2CACe;AASnC,SAASA,kBAAuD;QAAA,EACrEC,UAAUC,YAAY,EACtBC,QAAQ,EAEqB,GAJwC,QAGlEC,qCAHkE;QACrEH;QACAE;;IAGA,MAAM,CAACE,OAAOC,cAAc,GAAGP,wBAAwBK;IAEvD,MAAMH,WAAWM,OAAMC,WAAW,CAChC,CAACC;QACC,IAAIN,UAAU;YACZ;QACF;QAEAG,cAAcG,EAAEC,MAAM,CAACL,KAAK;QAC5BH,gBAAgBA,aAAaO;IAC/B,GACA;QAACH;QAAeJ;QAAcC;KAAS;IAGzC,OAAO;QAACE;QAAOJ;KAAS;AAC1B;AASO,SAASF,wBAAiC,EAC/CM,KAAK,EACLM,YAAY,EACZR,QAAQ,EACRF,UAAUC,YAAY,EACU;IAChC,MAAMU,eAAeP,UAAUQ;IAC/B,MAAM,CAACC,YAAYC,cAAc,GAAGR,OAAMS,QAAQ,CAACL;IACnD,MAAMM,8BAA8BV,OAAMW,MAAM;IAEhDC,IAAAA,oDAAyB,EAAC;QACxBF,4BAA4BG,OAAO,GAAGf;IACxC;IAEA,MAAMJ,WAAWM,OAAMC,WAAW,CAChC,CAACa;QACC,IAAIlB,UAAU;YACZ;QACF;QAEA,IAAImB,IAAAA,gBAAU,EAACD,YAAY;YACzB,IAAI,CAACT,cAAc;gBACjBG,cAAc,CAACQ;oBACb,MAAMC,gBAAgBH,UAAUE;oBAChC,IAAIrB,cAAc;wBAChBA,aAAasB;oBACf;oBACA,OAAOA;gBACT;YACF,OAAO,IAAItB,cAAc;gBACvB,MAAMsB,gBAAgBH,UAAUJ,4BAA4BG,OAAO;gBACnElB,aAAasB;YACf;QACF,OAAO;YACL,IAAItB,cAAc;gBAChBA,aAAamB;YACf;YACA,IAAI,CAACT,cAAc;gBACjBG,cAAcM;YAChB;QACF;IACF,GACA;QAAClB;QAAUS;QAAcV;KAAa;IAGxC,OAAO;QAACU,eAAeP,QAAQS;QAAYb;KAAS;AACtD"}