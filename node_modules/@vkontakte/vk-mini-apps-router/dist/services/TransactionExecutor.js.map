{"version":3,"file":"TransactionExecutor.js","sourceRoot":"","sources":["../../src/services/TransactionExecutor.ts"],"names":[],"mappings":"AAEA,MAAM,OAAO,mBAAmB;IAG9B,YAAoB,WAAuB;QAAvB,gBAAW,GAAX,WAAW,CAAY;QAFnC,iBAAY,GAA4B,EAAE,CAAC;IAEL,CAAC;IAE/C,IAAI,YAAY;QACd,OAAO,IAAI,CAAC,YAAY,CAAC,MAAM,GAAG,CAAC;YACjC,CAAC,IAAI,CAAC,YAAY,CAAC,MAAM,GAAG,CAAC,IAAI,IAAI,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC,aAAa,CAAC;YACpE,CAAC,CAAC,GAAG;YACL,CAAC,CAAC,CAAC,CAAC;IACR,CAAC;IAED,GAAG,CAAC,WAAkC;QACpC,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC;QACpC,IAAI,CAAC,WAAW,EAAE,CAAC;IACrB,CAAC;IAED,KAAK,CAAC,MAAM;QACV,gGAAgG;QAChG,UAAU,CAAC,GAAG,EAAE;YACd,IAAI,IAAI,CAAC,YAAY,CAAC,MAAM,EAAE;gBAC5B,IAAI,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC,MAAM,EAAE,CAAC;gBAC9B,IAAI,IAAI,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC,QAAQ,EAAE;oBACjC,IAAI,CAAC,YAAY,CAAC,KAAK,EAAE,CAAC;iBAC3B;aACF;QACH,CAAC,CAAC,CAAC;IACL,CAAC;CACF","sourcesContent":["import { NavigationTransaction } from '../entities/NavigationTransaction';\n\nexport class TransactionExecutor {\n  private transactions: NavigationTransaction[] = [];\n\n  constructor(private forceUpdate: () => void) {}\n\n  get initialDelay(): number {\n    return this.transactions.length > 1 ||\n      (this.transactions.length > 0 && this.transactions[0].isMultiAction)\n      ? 100\n      : 0;\n  }\n\n  add(transaction: NavigationTransaction): void {\n    this.transactions.push(transaction);\n    this.forceUpdate();\n  }\n\n  async doNext(): Promise<void> {\n    // Нужно делать асинхронно, иначе будет бесконечный цикл навигация-изменение стейта-навигация...\n    setTimeout(() => {\n      if (this.transactions.length) {\n        this.transactions[0].doNext();\n        if (this.transactions[0].finished) {\n          this.transactions.shift();\n        }\n      }\n    });\n  }\n}\n"]}