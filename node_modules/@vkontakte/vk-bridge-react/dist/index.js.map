{"version":3,"file":"index.js","sources":["../src/lib/react/useIsomorphicLayoutEffect.ts","../src/hooks/useAdaptivity.ts","../src/functions/runTapticImpactOccurred.ts","../src/hooks/useApperance.ts","../src/hooks/useInsets.ts"],"sourcesContent":["import { useLayoutEffect, useEffect } from 'react';\n\nexport const useIsomorphicLayoutEffect =\n  typeof window !== 'undefined' ? useLayoutEffect : useEffect;\n","import { useState } from 'react';\nimport vkBridge from '@vkontakte/vk-bridge';\nimport type {\n  VKBridgeEvent,\n  AnyReceiveMethodName,\n  AdaptivityType,\n  SharedUpdateConfigData,\n  ParentConfigData,\n} from '@vkontakte/vk-bridge';\nimport { useIsomorphicLayoutEffect } from '../lib/react';\n\nexport interface UseAdaptivity {\n  type: null | AdaptivityType;\n  viewportWidth: number;\n  viewportHeight: number;\n}\n\nconst initialState: UseAdaptivity = {\n  type: null,\n  viewportWidth: 0,\n  viewportHeight: 0,\n};\n\nexport const useAdaptivity = (): UseAdaptivity => {\n  const [bridgeAdaptivity, setBridgeAdaptivity] = useState<UseAdaptivity>(initialState);\n\n  useIsomorphicLayoutEffect(() => {\n    const updateAdaptivity = (data: ParentConfigData) => {\n      if (!('viewport_width' in data) || !('viewport_height' in data)) {\n        return;\n      }\n\n      const newAdaptivity = resolveAdaptivity(data);\n\n      if (newAdaptivity) {\n        setBridgeAdaptivity(newAdaptivity);\n      }\n    };\n\n    const handleBridgeEvent = (event: VKBridgeEvent<AnyReceiveMethodName>) => {\n      const { type, data } = event.detail;\n\n      if (type !== 'VKWebAppUpdateConfig') {\n        return;\n      }\n\n      updateAdaptivity(data);\n    };\n\n    vkBridge.subscribe(handleBridgeEvent);\n    vkBridge.send('VKWebAppGetConfig').then(updateAdaptivity).catch(console.error);\n\n    return () => {\n      vkBridge.unsubscribe(handleBridgeEvent);\n    };\n  }, []);\n\n  return bridgeAdaptivity;\n};\n\nfunction resolveAdaptivity(data: SharedUpdateConfigData): UseAdaptivity | null {\n  const { adaptivity, viewport_width, viewport_height } = data;\n\n  const bridgeAdaptivity: UseAdaptivity = {\n    type: null,\n    viewportWidth: isFinite(viewport_width) ? Number(viewport_width) : 0,\n    viewportHeight: isFinite(viewport_height) ? Number(viewport_height) : 0,\n  };\n\n  switch (adaptivity) {\n    case 'force_mobile':\n    case 'force_mobile_compact':\n    case 'adaptive':\n      bridgeAdaptivity.type = adaptivity;\n  }\n\n  return bridgeAdaptivity;\n}\n","import vkBridge from '@vkontakte/vk-bridge';\nimport type { TapticVibrationPowerType } from '@vkontakte/vk-bridge';\n\n/**\n * Dispatch device vibration if supported.\n *\n * Return `false` if not supported.\n */\nexport function runTapticImpactOccurred(style: TapticVibrationPowerType) {\n  if (vkBridge.supports('VKWebAppTapticImpactOccurred')) {\n    vkBridge.send('VKWebAppTapticImpactOccurred', { style }).catch(() => undefined);\n    return true;\n  }\n  return false;\n}\n","import { useState } from 'react';\nimport vkBridge from '@vkontakte/vk-bridge';\nimport type {\n  AnyReceiveMethodName,\n  VKBridgeEvent,\n  AppearanceType,\n  ParentConfigData,\n} from '@vkontakte/vk-bridge';\nimport { useIsomorphicLayoutEffect } from '../lib/react';\n\nexport type UseAppearance = AppearanceType | null;\n\n/**\n * Note: it works only for \"embedded\" app mode.\n */\nexport const useAppearance = (): UseAppearance => {\n  const [appearance, setAppearance] = useState<UseAppearance>(null);\n\n  useIsomorphicLayoutEffect(() => {\n    if (!vkBridge.isEmbedded()) {\n      return;\n    }\n\n    const updateAppearance = (data: ParentConfigData) => {\n      const initialAppearance = resolveAppearance(data);\n\n      if (initialAppearance) {\n        setAppearance(initialAppearance);\n      }\n    };\n\n    const handleBridgeEvent = (event: VKBridgeEvent<AnyReceiveMethodName>) => {\n      const { type, data } = event.detail;\n\n      if (type !== 'VKWebAppUpdateConfig' || !('appearance' in data) || !('scheme' in data)) {\n        return;\n      }\n\n      updateAppearance(data);\n    };\n\n    vkBridge.subscribe(handleBridgeEvent);\n    vkBridge.send('VKWebAppGetConfig').then(updateAppearance).catch(console.error);\n\n    return () => vkBridge.unsubscribe(handleBridgeEvent);\n  }, []);\n\n  return appearance;\n};\n\nfunction resolveAppearance({ scheme, appearance }: ParentConfigData): UseAppearance {\n  if (appearance) {\n    return appearance;\n  }\n\n  return scheme === 'space_gray' || scheme === 'vkcom_dark' ? 'dark' : 'light';\n}\n","import { useState } from 'react';\nimport vkBridge from '@vkontakte/vk-bridge';\nimport type { VKBridgeEvent, AnyReceiveMethodName, Insets } from '@vkontakte/vk-bridge';\nimport { useIsomorphicLayoutEffect } from '../lib/react';\n\nconst VIRTUAL_KEYBOARD_HEIGHT = 150;\n\nconst BOTTOM_INSET_FOR_VIRTUAL_KEYBOARD = 0;\n\nexport type UseInsets = {\n  top: Insets['top'];\n  right: Insets['right'];\n  bottom: Insets['bottom'];\n  left: Insets['left'];\n} | null;\n\nexport const useInsets = (): UseInsets => {\n  const [insets, setInsets] = useState<UseInsets>(null);\n\n  useIsomorphicLayoutEffect(() => {\n    const handleBridgeEvent = (event: VKBridgeEvent<AnyReceiveMethodName>) => {\n      const insets = resolveInsets(event);\n      if (insets) {\n        setInsets(insets);\n      }\n    };\n\n    vkBridge.subscribe(handleBridgeEvent);\n    return () => {\n      vkBridge.unsubscribe(handleBridgeEvent);\n    };\n  }, []);\n\n  return insets;\n};\n\nfunction resolveInsets(event: VKBridgeEvent<AnyReceiveMethodName>): UseInsets | null {\n  const { type, data } = event.detail;\n  switch (type) {\n    case 'VKWebAppUpdateInsets': // TODO [>=3]: it is legacy, remove it\n    case 'VKWebAppUpdateConfig':\n      if (!('insets' in data)) {\n        return null;\n      }\n      const { insets } = data;\n      if (insets) {\n        return {\n          ...insets,\n          bottom:\n            insets.bottom > VIRTUAL_KEYBOARD_HEIGHT\n              ? BOTTOM_INSET_FOR_VIRTUAL_KEYBOARD\n              : insets.bottom,\n        };\n      }\n  }\n  return null;\n}\n"],"names":["useIsomorphicLayoutEffect","window","useLayoutEffect","useEffect","initialState","type","viewportWidth","viewportHeight","style","vkBridge","supports","send","catch","_a","useState","bridgeAdaptivity","setBridgeAdaptivity","updateAdaptivity","data","newAdaptivity","adaptivity","viewport_width","viewport_height","isFinite","Number","resolveAdaptivity","handleBridgeEvent","event","detail","subscribe","then","console","error","unsubscribe","appearance","setAppearance","isEmbedded","updateAppearance","initialAppearance","scheme","resolveAppearance","insets","setInsets","__assign","bottom","resolveInsets"],"mappings":"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"}