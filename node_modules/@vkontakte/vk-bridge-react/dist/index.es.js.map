{"version":3,"file":"index.es.js","sources":["../src/lib/react/useIsomorphicLayoutEffect.ts","../src/hooks/useAdaptivity.ts","../src/hooks/useApperance.ts","../src/hooks/useInsets.ts","../src/functions/runTapticImpactOccurred.ts"],"sourcesContent":["import { useLayoutEffect, useEffect } from 'react';\n\nexport const useIsomorphicLayoutEffect =\n  typeof window !== 'undefined' ? useLayoutEffect : useEffect;\n","import { useState } from 'react';\nimport vkBridge from '@vkontakte/vk-bridge';\nimport type {\n  VKBridgeEvent,\n  AnyReceiveMethodName,\n  AdaptivityType,\n  SharedUpdateConfigData,\n  ParentConfigData,\n} from '@vkontakte/vk-bridge';\nimport { useIsomorphicLayoutEffect } from '../lib/react';\n\nexport interface UseAdaptivity {\n  type: null | AdaptivityType;\n  viewportWidth: number;\n  viewportHeight: number;\n}\n\nconst initialState: UseAdaptivity = {\n  type: null,\n  viewportWidth: 0,\n  viewportHeight: 0,\n};\n\nexport const useAdaptivity = (): UseAdaptivity => {\n  const [bridgeAdaptivity, setBridgeAdaptivity] = useState<UseAdaptivity>(initialState);\n\n  useIsomorphicLayoutEffect(() => {\n    const updateAdaptivity = (data: ParentConfigData) => {\n      if (!('viewport_width' in data) || !('viewport_height' in data)) {\n        return;\n      }\n\n      const newAdaptivity = resolveAdaptivity(data);\n\n      if (newAdaptivity) {\n        setBridgeAdaptivity(newAdaptivity);\n      }\n    };\n\n    const handleBridgeEvent = (event: VKBridgeEvent<AnyReceiveMethodName>) => {\n      const { type, data } = event.detail;\n\n      if (type !== 'VKWebAppUpdateConfig') {\n        return;\n      }\n\n      updateAdaptivity(data);\n    };\n\n    vkBridge.subscribe(handleBridgeEvent);\n    vkBridge.send('VKWebAppGetConfig').then(updateAdaptivity).catch(console.error);\n\n    return () => {\n      vkBridge.unsubscribe(handleBridgeEvent);\n    };\n  }, []);\n\n  return bridgeAdaptivity;\n};\n\nfunction resolveAdaptivity(data: SharedUpdateConfigData): UseAdaptivity | null {\n  const { adaptivity, viewport_width, viewport_height } = data;\n\n  const bridgeAdaptivity: UseAdaptivity = {\n    type: null,\n    viewportWidth: isFinite(viewport_width) ? Number(viewport_width) : 0,\n    viewportHeight: isFinite(viewport_height) ? Number(viewport_height) : 0,\n  };\n\n  switch (adaptivity) {\n    case 'force_mobile':\n    case 'force_mobile_compact':\n    case 'adaptive':\n      bridgeAdaptivity.type = adaptivity;\n  }\n\n  return bridgeAdaptivity;\n}\n","import { useState } from 'react';\nimport vkBridge from '@vkontakte/vk-bridge';\nimport type {\n  AnyReceiveMethodName,\n  VKBridgeEvent,\n  AppearanceType,\n  ParentConfigData,\n} from '@vkontakte/vk-bridge';\nimport { useIsomorphicLayoutEffect } from '../lib/react';\n\nexport type UseAppearance = AppearanceType | null;\n\n/**\n * Note: it works only for \"embedded\" app mode.\n */\nexport const useAppearance = (): UseAppearance => {\n  const [appearance, setAppearance] = useState<UseAppearance>(null);\n\n  useIsomorphicLayoutEffect(() => {\n    if (!vkBridge.isEmbedded()) {\n      return;\n    }\n\n    const updateAppearance = (data: ParentConfigData) => {\n      const initialAppearance = resolveAppearance(data);\n\n      if (initialAppearance) {\n        setAppearance(initialAppearance);\n      }\n    };\n\n    const handleBridgeEvent = (event: VKBridgeEvent<AnyReceiveMethodName>) => {\n      const { type, data } = event.detail;\n\n      if (type !== 'VKWebAppUpdateConfig' || !('appearance' in data) || !('scheme' in data)) {\n        return;\n      }\n\n      updateAppearance(data);\n    };\n\n    vkBridge.subscribe(handleBridgeEvent);\n    vkBridge.send('VKWebAppGetConfig').then(updateAppearance).catch(console.error);\n\n    return () => vkBridge.unsubscribe(handleBridgeEvent);\n  }, []);\n\n  return appearance;\n};\n\nfunction resolveAppearance({ scheme, appearance }: ParentConfigData): UseAppearance {\n  if (appearance) {\n    return appearance;\n  }\n\n  return scheme === 'space_gray' || scheme === 'vkcom_dark' ? 'dark' : 'light';\n}\n","import { useState } from 'react';\nimport vkBridge from '@vkontakte/vk-bridge';\nimport type { VKBridgeEvent, AnyReceiveMethodName, Insets } from '@vkontakte/vk-bridge';\nimport { useIsomorphicLayoutEffect } from '../lib/react';\n\nconst VIRTUAL_KEYBOARD_HEIGHT = 150;\n\nconst BOTTOM_INSET_FOR_VIRTUAL_KEYBOARD = 0;\n\nexport type UseInsets = {\n  top: Insets['top'];\n  right: Insets['right'];\n  bottom: Insets['bottom'];\n  left: Insets['left'];\n} | null;\n\nexport const useInsets = (): UseInsets => {\n  const [insets, setInsets] = useState<UseInsets>(null);\n\n  useIsomorphicLayoutEffect(() => {\n    const handleBridgeEvent = (event: VKBridgeEvent<AnyReceiveMethodName>) => {\n      const insets = resolveInsets(event);\n      if (insets) {\n        setInsets(insets);\n      }\n    };\n\n    vkBridge.subscribe(handleBridgeEvent);\n    return () => {\n      vkBridge.unsubscribe(handleBridgeEvent);\n    };\n  }, []);\n\n  return insets;\n};\n\nfunction resolveInsets(event: VKBridgeEvent<AnyReceiveMethodName>): UseInsets | null {\n  const { type, data } = event.detail;\n  switch (type) {\n    case 'VKWebAppUpdateInsets': // TODO [>=3]: it is legacy, remove it\n    case 'VKWebAppUpdateConfig':\n      if (!('insets' in data)) {\n        return null;\n      }\n      const { insets } = data;\n      if (insets) {\n        return {\n          ...insets,\n          bottom:\n            insets.bottom > VIRTUAL_KEYBOARD_HEIGHT\n              ? BOTTOM_INSET_FOR_VIRTUAL_KEYBOARD\n              : insets.bottom,\n        };\n      }\n  }\n  return null;\n}\n","import vkBridge from '@vkontakte/vk-bridge';\nimport type { TapticVibrationPowerType } from '@vkontakte/vk-bridge';\n\n/**\n * Dispatch device vibration if supported.\n *\n * Return `false` if not supported.\n */\nexport function runTapticImpactOccurred(style: TapticVibrationPowerType) {\n  if (vkBridge.supports('VKWebAppTapticImpactOccurred')) {\n    vkBridge.send('VKWebAppTapticImpactOccurred', { style }).catch(() => undefined);\n    return true;\n  }\n  return false;\n}\n"],"names":[],"mappings":"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"}